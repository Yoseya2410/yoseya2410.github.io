<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>8051 单片机 | 釉色鸭的笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./img/logo.png">
    <script type="text/javascript" src="./js/MicrosoftClarity.js"></script>
    <meta name="description" content="欢迎来到我的知识库，这里存放着我在自然科学，计算机科学，电子科学等领域所学习到的知识。">
    <meta name="author" content="钢铁直男釉色鸭">
    <meta name="baidu-site-verification" content="codeva-Tg016Vm0nu">
    <meta name="msvalidate.01" content="B6576B71940A163919B4737E9A751485">
    <meta name="google-site-verification" content="fV3hX5ZbIBy6PAxE0dubuOfSgI0nctKRpFwcbcsVB7w">
    
    <link rel="preload" href="/assets/css/0.styles.7324eb70.css" as="style"><link rel="preload" href="/assets/js/app.1cc258cf.js" as="script"><link rel="preload" href="/assets/js/3.107e051b.js" as="script"><link rel="preload" href="/assets/js/33.dae75e2c.js" as="script"><link rel="preload" href="/assets/js/5.56dd59ee.js" as="script"><link rel="prefetch" href="/assets/js/10.2b3e4369.js"><link rel="prefetch" href="/assets/js/11.c05c1ae2.js"><link rel="prefetch" href="/assets/js/12.40e6a7b8.js"><link rel="prefetch" href="/assets/js/13.f413abb3.js"><link rel="prefetch" href="/assets/js/14.c6111d4b.js"><link rel="prefetch" href="/assets/js/15.68d8aff1.js"><link rel="prefetch" href="/assets/js/16.ea59e35d.js"><link rel="prefetch" href="/assets/js/17.59b5a50d.js"><link rel="prefetch" href="/assets/js/18.3c65c578.js"><link rel="prefetch" href="/assets/js/19.2438d003.js"><link rel="prefetch" href="/assets/js/20.db4081be.js"><link rel="prefetch" href="/assets/js/21.4cafa004.js"><link rel="prefetch" href="/assets/js/22.b826a2dd.js"><link rel="prefetch" href="/assets/js/23.08d4b066.js"><link rel="prefetch" href="/assets/js/24.7f3357f8.js"><link rel="prefetch" href="/assets/js/25.ee322744.js"><link rel="prefetch" href="/assets/js/26.54b969b5.js"><link rel="prefetch" href="/assets/js/27.78cdf6ca.js"><link rel="prefetch" href="/assets/js/28.7d052513.js"><link rel="prefetch" href="/assets/js/29.882510d2.js"><link rel="prefetch" href="/assets/js/30.d200cedb.js"><link rel="prefetch" href="/assets/js/31.62023fc0.js"><link rel="prefetch" href="/assets/js/32.0b9d0b1c.js"><link rel="prefetch" href="/assets/js/34.3cdc7c00.js"><link rel="prefetch" href="/assets/js/35.d6c54db9.js"><link rel="prefetch" href="/assets/js/36.48bd47d8.js"><link rel="prefetch" href="/assets/js/37.1472c02c.js"><link rel="prefetch" href="/assets/js/38.598f12a9.js"><link rel="prefetch" href="/assets/js/39.7f3be8cb.js"><link rel="prefetch" href="/assets/js/4.3175c058.js"><link rel="prefetch" href="/assets/js/40.a6457d7c.js"><link rel="prefetch" href="/assets/js/41.e03182fe.js"><link rel="prefetch" href="/assets/js/42.edc35f60.js"><link rel="prefetch" href="/assets/js/43.3f48f145.js"><link rel="prefetch" href="/assets/js/44.c1a70845.js"><link rel="prefetch" href="/assets/js/45.fa4e9752.js"><link rel="prefetch" href="/assets/js/46.2491f52c.js"><link rel="prefetch" href="/assets/js/47.2e791849.js"><link rel="prefetch" href="/assets/js/48.a8cc8b70.js"><link rel="prefetch" href="/assets/js/49.cee5861e.js"><link rel="prefetch" href="/assets/js/50.3a1acf08.js"><link rel="prefetch" href="/assets/js/51.bd11c7aa.js"><link rel="prefetch" href="/assets/js/52.5f3bb057.js"><link rel="prefetch" href="/assets/js/53.7a029e2f.js"><link rel="prefetch" href="/assets/js/54.956659f9.js"><link rel="prefetch" href="/assets/js/55.692f41d6.js"><link rel="prefetch" href="/assets/js/56.cd825588.js"><link rel="prefetch" href="/assets/js/57.e68fb7c4.js"><link rel="prefetch" href="/assets/js/58.29f69425.js"><link rel="prefetch" href="/assets/js/59.09773648.js"><link rel="prefetch" href="/assets/js/6.3712678b.js"><link rel="prefetch" href="/assets/js/60.d4652a84.js"><link rel="prefetch" href="/assets/js/61.13b665f3.js"><link rel="prefetch" href="/assets/js/62.1ab83596.js"><link rel="prefetch" href="/assets/js/63.4a176233.js"><link rel="prefetch" href="/assets/js/64.3a323ed0.js"><link rel="prefetch" href="/assets/js/65.d1fee93f.js"><link rel="prefetch" href="/assets/js/66.857aab11.js"><link rel="prefetch" href="/assets/js/67.6170935d.js"><link rel="prefetch" href="/assets/js/68.8ba99be3.js"><link rel="prefetch" href="/assets/js/69.0c970f84.js"><link rel="prefetch" href="/assets/js/7.72cd435d.js"><link rel="prefetch" href="/assets/js/70.2a69396d.js"><link rel="prefetch" href="/assets/js/71.635e1c6e.js"><link rel="prefetch" href="/assets/js/72.f372e85d.js"><link rel="prefetch" href="/assets/js/73.cccd04e1.js"><link rel="prefetch" href="/assets/js/8.398eb1ea.js"><link rel="prefetch" href="/assets/js/9.c13a85dc.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.b132aabe.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7324eb70.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">釉色鸭的笔记</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="万维网" class="dropdown-title"><span class="title">万维网</span> <span class="arrow down"></span></button> <button type="button" aria-label="万维网" class="mobile-dropdown-title"><span class="title">万维网</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/html/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/web/html/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/web/javascript/JavaScript.html" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/javascript/nodejs.html" class="nav-link">
  Node.js
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/javascript/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/web/javascript/typescript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/web/javascript/WebAssembly.html" class="nav-link">
  WebAssembly
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/addition/json.html" class="nav-link">
  JSON
</a></li><li class="dropdown-subitem"><a href="/addition/vuepress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-subitem"><a href="/addition/浏览器扩展开发.html" class="nav-link">
  浏览器扩展开发
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/c/c.html" class="nav-link">
  C
</a></li><li class="dropdown-subitem"><a href="/computer/cpp/cpp.html" class="nav-link">
  C++
</a></li><li class="dropdown-subitem"><a href="/computer/python/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/computer/Java/java.html" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/离散数学.html" class="nav-link">
  离散数学
</a></li><li class="dropdown-subitem"><a href="/computer/计算机组成原理.html" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-subitem"><a href="/computer/计算机网络.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/computer/数据结构与算法.html" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-subitem"><a href="/computer/操作系统/操作系统.html" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/操作系统/Linux.html" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/computer/操作系统/HarmonyOS.html" class="nav-link">
  HarmonyOS
</a></li></ul></li><li class="dropdown-item"><h4>
          应用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/AI/机器学习.html" class="nav-link">
  机器学习
</a></li><li class="dropdown-subitem"><a href="/computer/数据库/数据库应用.html" class="nav-link">
  数据库应用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="物理学" class="dropdown-title"><span class="title">物理学</span> <span class="arrow down"></span></button> <button type="button" aria-label="物理学" class="mobile-dropdown-title"><span class="title">物理学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/力学.html" class="nav-link">
  力学
</a></li><li class="dropdown-subitem"><a href="/physics/热学.html" class="nav-link">
  热学
</a></li><li class="dropdown-subitem"><a href="/physics/电磁学.html" class="nav-link">
  电磁学
</a></li><li class="dropdown-subitem"><a href="/physics/光学.html" class="nav-link">
  光学
</a></li><li class="dropdown-subitem"><a href="/physics/原子物理.html" class="nav-link">
  原子物理
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/分析力学.html" class="nav-link">
  经典力学
</a></li><li class="dropdown-subitem"><a href="/physics/量子力学/量子力学1.html" class="nav-link">
  量子力学
</a></li><li class="dropdown-subitem"><a href="/physics/电动力学.html" class="nav-link">
  电动力学
</a></li><li class="dropdown-subitem"><a href="/physics/热力学与统计物理/热力学与统计物理1.html" class="nav-link">
  热力学与统计物理
</a></li></ul></li><li class="dropdown-item"><h4>
          数学
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/math/数学分析.html" class="nav-link">
  数学分析
</a></li><li class="dropdown-subitem"><a href="/physics/math/线性代数.html" class="nav-link">
  线性代数
</a></li><li class="dropdown-subitem"><a href="/physics/math/概率论与数理统计.html" class="nav-link">
  概率论与数理统计
</a></li><li class="dropdown-subitem"><a href="/physics/math/数学物理方法.html" class="nav-link">
  数学物理方法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="电子信息" class="dropdown-title"><span class="title">电子信息</span> <span class="arrow down"></span></button> <button type="button" aria-label="电子信息" class="mobile-dropdown-title"><span class="title">电子信息</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          电子
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/electronics/电路分析.html" class="nav-link">
  电路分析
</a></li><li class="dropdown-subitem"><a href="/electronics/模拟电子技术.html" class="nav-link">
  模拟电子技术
</a></li><li class="dropdown-subitem"><a href="/electronics/数字电子技术.html" class="nav-link">
  数字电子技术
</a></li><li class="dropdown-subitem"><a href="/electronics/数字信号处理.html" class="nav-link">
  数字信号处理
</a></li></ul></li><li class="dropdown-item"><h4>
          通信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/communication/通信原理.html" class="nav-link">
  通信原理
</a></li><li class="dropdown-subitem"><a href="/communication/信号与系统.html" class="nav-link">
  信号与系统
</a></li><li class="dropdown-subitem"><a href="/communication/信息论与编码.html" class="nav-link">
  信息论与编码
</a></li><li class="dropdown-subitem"><a href="/communication/电磁波与电磁场.html" class="nav-link">
  电磁波与电磁场
</a></li><li class="dropdown-subitem"><a href="/communication/微波技术与天线.html" class="nav-link">
  微波技术与天线
</a></li></ul></li><li class="dropdown-item"><h4>
          嵌入式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/嵌入式/8051.html" class="nav-link">
  8051单片机
</a></li><li class="dropdown-subitem"><a href="/computer/嵌入式/STM32.html" class="nav-link">
  STM32单片机
</a></li><li class="dropdown-subitem"><a href="/computer/嵌入式/esp32.html" class="nav-link">
  ESP32单片机
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/addition/xml.html" class="nav-link">
  XML
</a></li><li class="dropdown-subitem"><a href="/addition/latex.html" class="nav-link">
  LaTeX
</a></li><li class="dropdown-subitem"><a href="/addition/markdown.html" class="nav-link">
  Markdown
</a></li><li class="dropdown-subitem"><a href="/addition/git.html" class="nav-link">
  Git
</a></li></ul></li><li class="dropdown-item"><h4>
          链接
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/Warehouse/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文件仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.cnblogs.com/yoseya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/me/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/Yoseya2410" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="万维网" class="dropdown-title"><span class="title">万维网</span> <span class="arrow down"></span></button> <button type="button" aria-label="万维网" class="mobile-dropdown-title"><span class="title">万维网</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/html/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/web/html/css.html" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/web/javascript/JavaScript.html" class="nav-link">
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/javascript/nodejs.html" class="nav-link">
  Node.js
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/javascript/Vue.html" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/web/javascript/typescript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/web/javascript/WebAssembly.html" class="nav-link">
  WebAssembly
</a></li></ul></li><li class="dropdown-item"><h4>
          其他
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/addition/json.html" class="nav-link">
  JSON
</a></li><li class="dropdown-subitem"><a href="/addition/vuepress.html" class="nav-link">
  VuePress
</a></li><li class="dropdown-subitem"><a href="/addition/浏览器扩展开发.html" class="nav-link">
  浏览器扩展开发
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机" class="dropdown-title"><span class="title">计算机</span> <span class="arrow down"></span></button> <button type="button" aria-label="计算机" class="mobile-dropdown-title"><span class="title">计算机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          语言
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/c/c.html" class="nav-link">
  C
</a></li><li class="dropdown-subitem"><a href="/computer/cpp/cpp.html" class="nav-link">
  C++
</a></li><li class="dropdown-subitem"><a href="/computer/python/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-subitem"><a href="/computer/Java/java.html" class="nav-link">
  Java
</a></li></ul></li><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/离散数学.html" class="nav-link">
  离散数学
</a></li><li class="dropdown-subitem"><a href="/computer/计算机组成原理.html" class="nav-link">
  计算机组成原理
</a></li><li class="dropdown-subitem"><a href="/computer/计算机网络.html" class="nav-link">
  计算机网络
</a></li><li class="dropdown-subitem"><a href="/computer/数据结构与算法.html" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-subitem"><a href="/computer/操作系统/操作系统.html" class="nav-link">
  操作系统
</a></li></ul></li><li class="dropdown-item"><h4>
          系统
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/操作系统/Linux.html" class="nav-link">
  Linux
</a></li><li class="dropdown-subitem"><a href="/computer/操作系统/HarmonyOS.html" class="nav-link">
  HarmonyOS
</a></li></ul></li><li class="dropdown-item"><h4>
          应用
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/AI/机器学习.html" class="nav-link">
  机器学习
</a></li><li class="dropdown-subitem"><a href="/computer/数据库/数据库应用.html" class="nav-link">
  数据库应用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="物理学" class="dropdown-title"><span class="title">物理学</span> <span class="arrow down"></span></button> <button type="button" aria-label="物理学" class="mobile-dropdown-title"><span class="title">物理学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/力学.html" class="nav-link">
  力学
</a></li><li class="dropdown-subitem"><a href="/physics/热学.html" class="nav-link">
  热学
</a></li><li class="dropdown-subitem"><a href="/physics/电磁学.html" class="nav-link">
  电磁学
</a></li><li class="dropdown-subitem"><a href="/physics/光学.html" class="nav-link">
  光学
</a></li><li class="dropdown-subitem"><a href="/physics/原子物理.html" class="nav-link">
  原子物理
</a></li></ul></li><li class="dropdown-item"><h4>
          进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/分析力学.html" class="nav-link">
  经典力学
</a></li><li class="dropdown-subitem"><a href="/physics/量子力学/量子力学1.html" class="nav-link">
  量子力学
</a></li><li class="dropdown-subitem"><a href="/physics/电动力学.html" class="nav-link">
  电动力学
</a></li><li class="dropdown-subitem"><a href="/physics/热力学与统计物理/热力学与统计物理1.html" class="nav-link">
  热力学与统计物理
</a></li></ul></li><li class="dropdown-item"><h4>
          数学
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/physics/math/数学分析.html" class="nav-link">
  数学分析
</a></li><li class="dropdown-subitem"><a href="/physics/math/线性代数.html" class="nav-link">
  线性代数
</a></li><li class="dropdown-subitem"><a href="/physics/math/概率论与数理统计.html" class="nav-link">
  概率论与数理统计
</a></li><li class="dropdown-subitem"><a href="/physics/math/数学物理方法.html" class="nav-link">
  数学物理方法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="电子信息" class="dropdown-title"><span class="title">电子信息</span> <span class="arrow down"></span></button> <button type="button" aria-label="电子信息" class="mobile-dropdown-title"><span class="title">电子信息</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          电子
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/electronics/电路分析.html" class="nav-link">
  电路分析
</a></li><li class="dropdown-subitem"><a href="/electronics/模拟电子技术.html" class="nav-link">
  模拟电子技术
</a></li><li class="dropdown-subitem"><a href="/electronics/数字电子技术.html" class="nav-link">
  数字电子技术
</a></li><li class="dropdown-subitem"><a href="/electronics/数字信号处理.html" class="nav-link">
  数字信号处理
</a></li></ul></li><li class="dropdown-item"><h4>
          通信
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/communication/通信原理.html" class="nav-link">
  通信原理
</a></li><li class="dropdown-subitem"><a href="/communication/信号与系统.html" class="nav-link">
  信号与系统
</a></li><li class="dropdown-subitem"><a href="/communication/信息论与编码.html" class="nav-link">
  信息论与编码
</a></li><li class="dropdown-subitem"><a href="/communication/电磁波与电磁场.html" class="nav-link">
  电磁波与电磁场
</a></li><li class="dropdown-subitem"><a href="/communication/微波技术与天线.html" class="nav-link">
  微波技术与天线
</a></li></ul></li><li class="dropdown-item"><h4>
          嵌入式
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/computer/嵌入式/8051.html" class="nav-link">
  8051单片机
</a></li><li class="dropdown-subitem"><a href="/computer/嵌入式/STM32.html" class="nav-link">
  STM32单片机
</a></li><li class="dropdown-subitem"><a href="/computer/嵌入式/esp32.html" class="nav-link">
  ESP32单片机
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title">更多</span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          工具
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/addition/xml.html" class="nav-link">
  XML
</a></li><li class="dropdown-subitem"><a href="/addition/latex.html" class="nav-link">
  LaTeX
</a></li><li class="dropdown-subitem"><a href="/addition/markdown.html" class="nav-link">
  Markdown
</a></li><li class="dropdown-subitem"><a href="/addition/git.html" class="nav-link">
  Git
</a></li></ul></li><li class="dropdown-item"><h4>
          链接
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/Warehouse/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文件仓库
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/docs/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的项目
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.cnblogs.com/yoseya" target="_blank" rel="noopener noreferrer" class="nav-link external">
  我的博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://yoseya2410.github.io/me/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  关于我
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="https://github.com/Yoseya2410" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>8051 单片机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-用单片机点亮-led-灯" class="sidebar-link">实践：用单片机点亮 LED 灯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#使用vscode开发51单片机" class="sidebar-link">使用VScode开发51单片机</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是单片机头文件-为什么要引入这个文件" class="sidebar-link">什么是单片机头文件？为什么要引入这个文件？</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是串口-端口-i-o-口" class="sidebar-link">什么是串口，端口，I/O 口？</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是串行传输" class="sidebar-link">什么是串行传输？</a></li></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-点亮多个-led-灯" class="sidebar-link">实践：点亮多个 LED 灯</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-led-闪烁" class="sidebar-link">实践：LED 闪烁</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-流水灯" class="sidebar-link">实践：流水灯</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-按键的使用" class="sidebar-link">实践：按键的使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#按键抖动问题" class="sidebar-link">按键抖动问题</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#通过按键控制-led-灯亮灭" class="sidebar-link">通过按键控制 LED 灯亮灭</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#如何实现按下按钮时-led-灯熄灭-松开按钮后-led-灯点亮" class="sidebar-link">如何实现按下按钮时 LED 灯熄灭，松开按钮后 LED 灯点亮？</a></li></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-用矩阵键盘控制-lcd1602-屏幕的显示" class="sidebar-link">实践：用矩阵键盘控制 LCD1602 屏幕的显示</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#矩阵键盘" class="sidebar-link">矩阵键盘</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#行列扫描法" class="sidebar-link">行列扫描法</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#lcd1602-工作原理" class="sidebar-link">LCD1602 工作原理</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#lcd1602-的使用" class="sidebar-link">LCD1602 的使用</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#程序-根据按键在-lcd1602-屏幕显示内容" class="sidebar-link">程序：根据按键在 LCD1602 屏幕显示内容</a></li></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#定时器与中断" class="sidebar-link">定时器与中断</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#定时器原理" class="sidebar-link">定时器原理</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#中断系统" class="sidebar-link">中断系统</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#控制位" class="sidebar-link">控制位</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#实践-制作简单的计时器" class="sidebar-link">实践：制作简单的计时器</a></li></ul></li><li><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#串口通信" class="sidebar-link">串口通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是串口通信" class="sidebar-link">什么是串口通信?</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是串行通信-什么是并行通信" class="sidebar-link">什么是串行通信？什么是并行通信？</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#异步通信和同步通信的区别是什么" class="sidebar-link">异步通信和同步通信的区别是什么？</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#串行控制寄存器-scon" class="sidebar-link">串行控制寄存器 SCON</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#什么是波特率" class="sidebar-link">什么是波特率？</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#常用波特率初值表" class="sidebar-link">常用波特率初值表</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#代码示例" class="sidebar-link">代码示例</a></li><li class="sidebar-sub-header"><a href="/computer/%E5%B5%8C%E5%85%A5%E5%BC%8F/8051.html#蓝牙模块通过串口通信控制舵机" class="sidebar-link">蓝牙模块通过串口通信控制舵机</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_8051-单片机"><a href="#_8051-单片机" class="header-anchor">#</a> 8051 单片机</h1> <p><strong>8051 单片机是一种经典的 8 位单片机，由英特尔（Intel）公司在 1980 年推出。它是一种基于哈佛架构的单片机，具有内部 ROM、RAM、IO 等外设，同时还支持多种外部接口，如串口、定时器、中断等。</strong> 8051 单片机是一种通用型微控制器，广泛应用于各种嵌入式系统和电子设备中。</p> <p>8051 单片机的特点和优势主要包括以下几个方面：</p> <ul><li>成本低廉：由于 8051 单片机集成度高、制造工艺成熟，因此价格相对较低，非常适合于大批量生产和应用。</li> <li>易于学习和使用：由于 8051 单片机使用的指令集比较简单，因此上手和学习比较容易，即使是没有编程经验的人也可以很快掌握。</li> <li>可扩展性强：8051 单片机的设计具有很强的可扩展性，支持多种外部接口，可以实现与其他硬件设备的连接和通信。</li></ul> <p>生产 51 单片机的厂商有很多，所以 51 单片机的型号也很多，市面上有许多单片机都是从 51 内核扩展出来的单片机，这些单片机的使用都是相通的，只要学会一款 8051 单片机的应用，其他单片机也就可以上手使用。所以之后的内容都以 STC 公司生产的<strong>STC89C52RC</strong>这款单片机为例</p> <p><strong>这是 STC89C52 单片机的各个引脚：</strong></p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/8051%E5%8D%95%E7%89%87%E6%9C%BA.png" alt="8051单片机"></p> <p><strong>STC89C52 单片机有 40 个引脚，具体各个引脚的作用如下：</strong></p> <ul><li><strong>P0 端口</strong>：有 8 个引脚，P0.0-P0.7，是通用的输入输出口</li> <li><strong>P1 端口</strong>：有 8 个引脚，P1.0-P1.7，是通用的输入输出口</li> <li><strong>P2 端口</strong>：有 8 个引脚，P2.0-P2.7，是通用的输入输出口</li> <li><strong>P3 端口</strong>：有 8 个引脚，P3.0-P3.7，是通用的输入输出口，同时具有第二功能。
<ul><li>P3.0 和 P3.1（RXD 和 TXD）可用于串行通信</li> <li>P3.2 和 P3.3（INT0 和 INT1）可用于外部中断 0 和 1 的触发</li> <li>P3.4 和 P3.5（T0 和 T1）可用于定时器 0 和 1 的计数和控制</li> <li>P3.6 和 P3.7（WR 和 RD）可用于外部存储器的控制</li></ul></li></ul> <p><strong>以上四个端口默认为输出状态</strong></p> <ul><li><strong>RST</strong>：复位引脚，低电平有效</li> <li><strong>RXD</strong>：为接收数据的引脚</li> <li><strong>TXD</strong>：为发送数据的引脚</li></ul> <p><strong>RXD 口和 TXD 口是单片机的串口通信端口，可以连接外部串口设备。</strong></p> <ul><li><strong>INT0</strong>：外部中断 0 输入</li> <li><strong>INT1</strong>：外部中断 1 输入</li> <li><strong>WR</strong>：外部存储器写使能控制引脚</li> <li><strong>RD</strong>：外部存储器读使能控制引脚</li></ul> <p><strong>RD 和 WR 是单片机与外部存储器进行数据读取和写入时使用的控制端口</strong></p> <ul><li>X<strong>TAL1</strong>：晶体振荡器输入引脚</li> <li><strong>XTAL2</strong>：晶体振荡器输出引脚</li></ul> <p><strong>XTAL1 和 XTAL2 用于连接外部晶振时使用的端口</strong></p> <ul><li><strong>ALE</strong>：地址锁存器使能控制引脚</li> <li><strong>EA</strong>：EA 引脚为片内程序存储器 ROM 的启动控制端。
<ul><li>EA=0 时，CPU 将从片内 ROM 地址 0000H 开始执行程序。</li> <li>EA=1 时，CPU 将从外部存储器或 EPROM 中的 0000H 开始执行程序</li></ul></li> <li><strong>PSEN</strong>：PSEN 引脚为程序存储器片选端。
<ul><li>当 PSEN=0 时，程序存储器被选中，CPU 从程序存储器中读取指令</li> <li>当 PSEN=1 时，CPU 从数据存储器中读取数据</li></ul></li> <li>T0 口和 T1 口是单片机的定时器输入/输出端口，可以连接外部定时器/计数器。</li> <li><strong>GND</strong>：电源接地/负极</li> <li><strong>VCC</strong>：电源正极</li></ul> <h3 id="单片机有什么用"><a href="#单片机有什么用" class="header-anchor">#</a> 单片机有什么用？</h3> <p>单片机是一种微型计算机，我们可以通过单片机来控制电路从而制造出各种各样的电子产品。例如，控制和监测各种设备和系统，用于各种应用，如智能家居、自动化控制、汽车电子、医疗仪器、航空航天、机器人技术等。</p> <h3 id="如何使用单片机去控制电路"><a href="#如何使用单片机去控制电路" class="header-anchor">#</a> 如何使用单片机去控制电路？</h3> <p>我们需要给单片机编写程序从而实现对电路的控制，一般我们要先使用软件<a href="https://www.keil.com/" target="_blank" rel="noopener noreferrer">Keil<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>编写程序然后把它打包成<code>.hex</code>格式的文件，这是一个 16 进制的文件，这里面包含了地址和数据，再通过软件<a href="https://www.stcmicro.com/rjxz.html" target="_blank" rel="noopener noreferrer">stc-isp<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>把程序（<code>.hex</code> 格式的文件）烧录到单片机中</p> <p><strong>好了，现在我们已经对单片机有了一个大概的了解，就让我们上手使用单片机吧，先从点亮一个 LED 灯开始！</strong> （在学习单片机前你需要有<a href="/computer/c/c.html">C 语言</a>的基础，至少能读懂它）</p> <h3 id="_51-单片机程序烧录"><a href="#_51-单片机程序烧录" class="header-anchor">#</a> 51 单片机程序烧录</h3> <p>8051 单片机程序的烧录可以通过编程器来实现。编程器可以将编写好的程序代码烧录到单片机的 Flash 或 EEPROM 中，以便单片机在运行时能够执行程序代码。</p> <p><strong>8051 单片机程序烧录的一般步骤</strong>：</p> <ol><li><strong>准备编程器</strong>：选购合适的编程器，并连接到计算机和单片机。这里我选择使用 USB-TTL 转换器，它可以将计算机的 USB 接口转换为串口接口</li> <li><strong>验证程序代码</strong>：对编写好的程序代码进行校验，确保程序代码正确无误。</li> <li><strong>准备程序代码</strong>：将编写好的程序代码编译成单片机可执行文件，一般为 HEX 或 BIN 格式。</li> <li><strong>连接单片机</strong>：将编程器与单片机连接，以 USB-TTL 为例</li></ol> <ul><li>将<strong>USB-TTL 转换器的 TXD 引脚</strong>连接到单片机的<strong>RXD 引脚</strong>上，用于将数据从计算机发送到单片机。</li> <li>将<strong>USB-TTL 转换器的 RXD 引脚</strong>连接到单片机的<strong>TXD 引脚</strong>上，用于将数据从单片机发送回计算机。</li> <li>将<strong>USB-TTL 转换器的 GND 引脚</strong>连接到单片机的<strong>GND 引脚</strong>上，用于单片机供电和信号共地。</li> <li>将<strong>USB-TTL 转换器的 5V 引脚</strong>连接到单片机的<strong>VCC 引脚</strong>上，用于单片机供电提供电源和信号共地。</li></ul> <ol start="5"><li><strong>烧录程序代码</strong>：使用烧录软件将程序代码写入单片机的 Flash 或 EEPROM 中。由于我使用的是 STC 的单片机，所以这里我使用软件 stc-isp ，不同单片机有不同的烧录软件或烧录方法，根据实际情况操作</li></ol> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>以上只是单片机程序烧录的大致操作，先连接好单片机和烧录工具，在之后的实践中我们会进行具体的操作</p></div> <h3 id="什么是-flash-什么是-eeprom"><a href="#什么是-flash-什么是-eeprom" class="header-anchor">#</a> 什么是 Flash？什么是 EEPROM？</h3> <p><strong>Flash 和 EEPROM 是常见的非易失性存储器件，都用于储存程序代码和数据。</strong></p> <p><strong>Flash 全称为&quot;快闪存储器&quot;（Flash Memory）</strong>，与 ROM（Read Only Memory）类似，但它可以在应用程序运行时被重新编程，而 ROM 烧录后就只能读取，不能修改。它的容量通常比 EEPROM 大，但编程和擦除速度比 EEPROM 慢。Flash 存储器适用于需要在运行时对程序代码进行更新的应用程序，例如固件更新、嵌入式系统和移动设备等。</p> <p><strong>EEPROM 全称为&quot;电可擦可编程只读存储器&quot;（Electrically Erasable Programmable Read-Only Memory）</strong>，容量较小，编程和擦除速度比 Flash 存储器快。它适用于需要存储少量数据的应用程序，例如存储校准参数、配置文件、密码和用户数据等。</p> <p><strong>它们之间的区别</strong>：</p> <ul><li><strong>容量</strong>：Flash 存储器的容量通常比 EEPROM 大，因为 Flash 存储器通常用于存储程序代码和大量数据，而 EEPROM 存储器通常用于存储少量数据。</li> <li><strong>速度</strong>：EEPROM 存储器的编程和擦除速度比 Flash 存储器快，但 Flash 存储器通常具有更快的读取速度。</li> <li><strong>使用方式</strong>：Flash 存储器和 EEPROM 存储器的使用方式和接口有所不同。Flash 存储器通常使用块擦除和扇区擦除等方式进行擦除操作，而 EEPROM 存储器通常使用字节级擦除和编程操作。
<ul><li><strong>块擦除</strong>：一次性擦除整个存储器的数据</li> <li><strong>扇擦除</strong>：只擦除存储器的一部分数据，以扇区为单位</li> <li><strong>字节级擦除</strong>：一个字节一个字节的擦除全部数据</li></ul></li> <li><strong>寿命</strong>：Flash 存储器和 EEPROM 存储器的寿命都有限，但它们的寿命与使用方式和擦写次数有关。通常来说，EEPROM 存储器的寿命要比 Flash 存储器长。</li></ul> <h2 id="实践-用单片机点亮-led-灯"><a href="#实践-用单片机点亮-led-灯" class="header-anchor">#</a> 实践：用单片机点亮 LED 灯</h2> <ol><li>先在 <strong>keil</strong> 中创建一个项目，创建项目时选对单片机的型号（<strong>如果你和我一样使用的是 STC89C52 这款单片机，你可以选择 AT89C52，这两款单片机只是生产厂商不同，使用时都是一样的</strong>）在项目中新建 <strong>main.c</strong> 文件，并把以下代码写入文件。文件应添加在 <strong>Source Group 1</strong> 中</li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入单片机头文件</span></span>

sbit LED <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//给P1.0引脚命名为LED</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LED <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//把引脚P1.0设为低电平</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>0</code>表示低电平<code>1</code>表示高电平</li> <li>LED 正极接<code>VCC</code>，负极接引脚<code>P1.0</code>。</li> <li><code>VCC</code>是高电平，电流从高电平流向低电平，只要把引脚<code>P1.0</code>设为低电平时，LED 灯亮</li></ul> <ol start="2"><li>打开 <code>Options for Target</code> —&gt; <code>Output</code> —&gt; 勾选 <code>Create HEX File</code></li> <li>点击 <code>Translate</code> 查看代码是否有误，如果正常就点击 <code>Build</code> 构建</li> <li>构建完成后你的项目文件夹 <code>Objects</code> 中会出现一个 <code>.hex</code> 格式的文件</li> <li>打开软件 <strong>stc-isp</strong> ，通过烧录器连接单片机和电脑，选中 <code>.hex</code> 格式的文件并烧录/下载到单片机上</li></ol> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>在一些电脑上由于缺少USB转串口的驱动，导致烧录失败，这时可以在 <strong>stc-isp</strong> 中找到 <strong>USB驱动程序</strong> 安装驱动，也可以下载 <a href="https://www.wch.cn/downloads/CH341SER_EXE.html" target="_blank" rel="noopener noreferrer">CH341SER<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 手动安装驱动</p></div> <blockquote><p><strong>链接</strong></p> <p>如果初学者觉得文章难懂推荐看该视频进行学习</p> <p><a href="https://www.bilibili.com/video/BV1nS4y1N7Az/?share_source=copy_web&amp;vd_source=f593b5be3aefe519cea20d1a5086e5bb" target="_blank" rel="noopener noreferrer">十分钟一集 51 单片机，手把手教你敲代码 _ 阿熊话太多<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="使用vscode开发51单片机"><a href="#使用vscode开发51单片机" class="header-anchor">#</a> 使用VScode开发51单片机</h3> <p>先使用 Keil 编写代码，再使用 stc-isp 等烧录工具进行烧录，步骤有点太繁琐了。可以使用VScode 直接进行开发，编写完程序后直接烧录。</p> <ol><li>在VScode中开发51单片机需要先安装相插件 <code>Embedded IDE</code>、<code>C\C++</code></li> <li>在 keil 中创建一个新项目，并使用 Embedded IDE 将项目导入到 VScode 中</li> <li>在 Embedded IDE 中可以安装烧录工具可以使用 <a href="https://em-ide.com/docs/modules/flasher#%E4%BD%BF%E7%94%A8-shell-%E5%91%BD%E4%BB%A4%E7%83%A7%E5%BD%95" target="_blank" rel="noopener noreferrer">shell 命令烧录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，也可以使用<a href="https://em-ide.com/docs/modules/flasher#stcgal" target="_blank" rel="noopener noreferrer">stcgal 烧录<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（仅支持 <code>STC 89/90/10/11/12/15/8</code> 系列的 MCU）</li></ol> <ul><li>使用 shell 命令烧录需要安装 Python 模块 <code>pyserial</code></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> pyserial
</code></pre></div><ul><li>使用 stcgal 烧录需要安装基于 Python 的 <code>stcgal</code> 工具</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>pip <span class="token function">install</span> stcgal
</code></pre></div><ol start="4"><li>安装好工具后就可以烧录编译好的程序了</li></ol> <p><strong>推荐文章</strong>：<a href="https://blog.csdn.net/Yoseya2410/article/details/150861211?fromshare=blogdetail&amp;sharetype=blogdetail&amp;sharerId=150861211&amp;sharerefer=PC&amp;sharesource=Yoseya2410&amp;sharefrom=from_link" target="_blank" rel="noopener noreferrer">使用VScode + Embedded IDE 开发51单片机<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="什么是单片机头文件-为什么要引入这个文件"><a href="#什么是单片机头文件-为什么要引入这个文件" class="header-anchor">#</a> 什么是单片机头文件？为什么要引入这个文件？</h3> <ul><li><strong>reg51.h</strong> 和 <strong>reg52.h</strong> 是一种用于 8051 系列单片机编程的头文件（header file）</li> <li>头文件中包含了 8051 系列单片机的寄存器定义和位定义，以便程序员在编写程序时可以更方便地访问这些寄存器和位，以实现对单片机的各种控制和操作。</li> <li>通过使用这些头文件中定义的宏，程序员可以轻松地访问单片机的串口、定时器、中断等功能，从而实现更加复杂的控制和操作。</li> <li>头文件 <strong>reg51.h</strong> 用于型号为 80C51 和 80C31 的微控制器，头文件 <strong>reg52.h</strong> 用与型号为 80C52 和 80C32 的微控制器</li></ul> <details class="custom-block details"><summary>reg51.h</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/*--------------------------------------------------------------------------
REG51.H
Header file for generic 80C51 and 80C31 microcontroller.
Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
All rights reserved.
--------------------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__REG51_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__REG51_H__</span></span>
<span class="token comment">/* BYTE Register */</span>
sfr P0 <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span>
sfr P1 <span class="token operator">=</span> <span class="token number">0x90</span><span class="token punctuation">;</span>
sfr P2 <span class="token operator">=</span> <span class="token number">0xA0</span><span class="token punctuation">;</span>
sfr P3 <span class="token operator">=</span> <span class="token number">0xB0</span><span class="token punctuation">;</span>
sfr PSW <span class="token operator">=</span> <span class="token number">0xD0</span><span class="token punctuation">;</span>
sfr ACC <span class="token operator">=</span> <span class="token number">0xE0</span><span class="token punctuation">;</span>
sfr B <span class="token operator">=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span>
sfr SP <span class="token operator">=</span> <span class="token number">0x81</span><span class="token punctuation">;</span>
sfr DPL <span class="token operator">=</span> <span class="token number">0x82</span><span class="token punctuation">;</span>
sfr DPH <span class="token operator">=</span> <span class="token number">0x83</span><span class="token punctuation">;</span>
sfr PCON <span class="token operator">=</span> <span class="token number">0x87</span><span class="token punctuation">;</span>
sfr TCON <span class="token operator">=</span> <span class="token number">0x88</span><span class="token punctuation">;</span>
sfr TMOD <span class="token operator">=</span> <span class="token number">0x89</span><span class="token punctuation">;</span>
sfr TL0 <span class="token operator">=</span> <span class="token number">0x8A</span><span class="token punctuation">;</span>
sfr TL1 <span class="token operator">=</span> <span class="token number">0x8B</span><span class="token punctuation">;</span>
sfr TH0 <span class="token operator">=</span> <span class="token number">0x8C</span><span class="token punctuation">;</span>
sfr TH1 <span class="token operator">=</span> <span class="token number">0x8D</span><span class="token punctuation">;</span>
sfr IE <span class="token operator">=</span> <span class="token number">0xA8</span><span class="token punctuation">;</span>
sfr IP <span class="token operator">=</span> <span class="token number">0xB8</span><span class="token punctuation">;</span>
sfr SCON <span class="token operator">=</span> <span class="token number">0x98</span><span class="token punctuation">;</span>
sfr SBUF <span class="token operator">=</span> <span class="token number">0x99</span><span class="token punctuation">;</span>
<span class="token comment">/* BIT Register */</span>
<span class="token comment">/* PSW */</span>
sbit CY <span class="token operator">=</span> <span class="token number">0xD7</span><span class="token punctuation">;</span>
sbit AC <span class="token operator">=</span> <span class="token number">0xD6</span><span class="token punctuation">;</span>
sbit F0 <span class="token operator">=</span> <span class="token number">0xD5</span><span class="token punctuation">;</span>
sbit RS1 <span class="token operator">=</span> <span class="token number">0xD4</span><span class="token punctuation">;</span>
sbit RS0 <span class="token operator">=</span> <span class="token number">0xD3</span><span class="token punctuation">;</span>
sbit OV <span class="token operator">=</span> <span class="token number">0xD2</span><span class="token punctuation">;</span>
sbit P <span class="token operator">=</span> <span class="token number">0xD0</span><span class="token punctuation">;</span>
<span class="token comment">/* TCON */</span>
sbit TF1 <span class="token operator">=</span> <span class="token number">0x8F</span><span class="token punctuation">;</span>
sbit TR1 <span class="token operator">=</span> <span class="token number">0x8E</span><span class="token punctuation">;</span>
sbit TF0 <span class="token operator">=</span> <span class="token number">0x8D</span><span class="token punctuation">;</span>
sbit TR0 <span class="token operator">=</span> <span class="token number">0x8C</span><span class="token punctuation">;</span>
sbit IE1 <span class="token operator">=</span> <span class="token number">0x8B</span><span class="token punctuation">;</span>
sbit IT1 <span class="token operator">=</span> <span class="token number">0x8A</span><span class="token punctuation">;</span>
sbit IE0 <span class="token operator">=</span> <span class="token number">0x89</span><span class="token punctuation">;</span>
sbit IT0 <span class="token operator">=</span> <span class="token number">0x88</span><span class="token punctuation">;</span>
<span class="token comment">/* IE */</span>
sbit EA <span class="token operator">=</span> <span class="token number">0xAF</span><span class="token punctuation">;</span>
sbit ES <span class="token operator">=</span> <span class="token number">0xAC</span><span class="token punctuation">;</span>
sbit ET1 <span class="token operator">=</span> <span class="token number">0xAB</span><span class="token punctuation">;</span>
sbit EX1 <span class="token operator">=</span> <span class="token number">0xAA</span><span class="token punctuation">;</span>
sbit ET0 <span class="token operator">=</span> <span class="token number">0xA9</span><span class="token punctuation">;</span>
sbit EX0 <span class="token operator">=</span> <span class="token number">0xA8</span><span class="token punctuation">;</span>
<span class="token comment">/* IP */</span>
sbit PS <span class="token operator">=</span> <span class="token number">0xBC</span><span class="token punctuation">;</span>
sbit PT1 <span class="token operator">=</span> <span class="token number">0xBB</span><span class="token punctuation">;</span>
sbit PX1 <span class="token operator">=</span> <span class="token number">0xBA</span><span class="token punctuation">;</span>
sbit PT0 <span class="token operator">=</span> <span class="token number">0xB9</span><span class="token punctuation">;</span>
sbit PX0 <span class="token operator">=</span> <span class="token number">0xB8</span><span class="token punctuation">;</span>
<span class="token comment">/* P3 */</span>
sbit RD <span class="token operator">=</span> <span class="token number">0xB7</span><span class="token punctuation">;</span>
sbit WR <span class="token operator">=</span> <span class="token number">0xB6</span><span class="token punctuation">;</span>
sbit T1 <span class="token operator">=</span> <span class="token number">0xB5</span><span class="token punctuation">;</span>
sbit T0 <span class="token operator">=</span> <span class="token number">0xB4</span><span class="token punctuation">;</span>
sbit INT1 <span class="token operator">=</span> <span class="token number">0xB3</span><span class="token punctuation">;</span>
sbit INT0 <span class="token operator">=</span> <span class="token number">0xB2</span><span class="token punctuation">;</span>
sbit TXD <span class="token operator">=</span> <span class="token number">0xB1</span><span class="token punctuation">;</span>
sbit RXD <span class="token operator">=</span> <span class="token number">0xB0</span><span class="token punctuation">;</span>
<span class="token comment">/* SCON */</span>
sbit SM0 <span class="token operator">=</span> <span class="token number">0x9F</span><span class="token punctuation">;</span>
sbit SM1 <span class="token operator">=</span> <span class="token number">0x9E</span><span class="token punctuation">;</span>
sbit SM2 <span class="token operator">=</span> <span class="token number">0x9D</span><span class="token punctuation">;</span>
sbit REN <span class="token operator">=</span> <span class="token number">0x9C</span><span class="token punctuation">;</span>
sbit TB8 <span class="token operator">=</span> <span class="token number">0x9B</span><span class="token punctuation">;</span>
sbit RB8 <span class="token operator">=</span> <span class="token number">0x9A</span><span class="token punctuation">;</span>
sbit TI <span class="token operator">=</span> <span class="token number">0x99</span><span class="token punctuation">;</span>
sbit RI <span class="token operator">=</span> <span class="token number">0x98</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></div></details> <details class="custom-block details"><summary>reg52.h</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">/*--------------------------------------------------------------------------
REG52.H
Header file for generic 80C52 and 80C32 microcontroller.
Copyright (c) 1988-2002 Keil Elektronik GmbH and Keil Software, Inc.
All rights reserved.
--------------------------------------------------------------------------*/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__REG52_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__REG52_H__</span> <span class="token comment">//定义了一个宏，用于避免重复包含该头文件</span></span>
<span class="token comment">/* BYTE Registers */</span>
sfr P0 <span class="token operator">=</span> <span class="token number">0x80</span><span class="token punctuation">;</span> <span class="token comment">// 端口0的特殊功能寄存器地址，用于控制I/O口的输入输出</span>
sfr P1 <span class="token operator">=</span> <span class="token number">0x90</span><span class="token punctuation">;</span> <span class="token comment">// 端口1的特殊功能寄存器地址，用于控制I/O口的输入输出</span>
sfr P2 <span class="token operator">=</span> <span class="token number">0xA0</span><span class="token punctuation">;</span> <span class="token comment">// 端口2的特殊功能寄存器地址，用于控制I/O口的输入输出</span>
sfr P3 <span class="token operator">=</span> <span class="token number">0xB0</span><span class="token punctuation">;</span> <span class="token comment">// 端口3的特殊功能寄存器地址，用于控制I/O口的输入输出</span>
sfr PSW <span class="token operator">=</span> <span class="token number">0xD0</span><span class="token punctuation">;</span> <span class="token comment">// CPU状态寄存器地址，包含中断控制和CPU运行状态等信息</span>
sfr ACC <span class="token operator">=</span> <span class="token number">0xE0</span><span class="token punctuation">;</span> <span class="token comment">// 累加器的特殊功能寄存器地址，用于运算时的暂存和结果输出</span>
sfr B <span class="token operator">=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span> <span class="token comment">// B寄存器的特殊功能寄存器地址，用于某些指令操作的时候临时存储数据</span>
sfr SP <span class="token operator">=</span> <span class="token number">0x81</span><span class="token punctuation">;</span> <span class="token comment">// 堆栈指针的特殊功能寄存器地址，用于指向当前的堆栈位置</span>
sfr DPL <span class="token operator">=</span> <span class="token number">0x82</span><span class="token punctuation">;</span> <span class="token comment">// 数据指针的低8位的特殊功能寄存器地址，用于访问外部数据存储器</span>
sfr DPH <span class="token operator">=</span> <span class="token number">0x83</span><span class="token punctuation">;</span> <span class="token comment">// 数据指针的高8位的特殊功能寄存器地址，用于访问外部数据存储器</span>
sfr PCON <span class="token operator">=</span> <span class="token number">0x87</span><span class="token punctuation">;</span> <span class="token comment">// 电源控制寄存器地址，用于控制电源管理和系统的低功耗状态</span>
sfr TCON <span class="token operator">=</span> <span class="token number">0x88</span><span class="token punctuation">;</span> <span class="token comment">// 定时器控制寄存器地址，用于控制定时器的计数和相关的中断</span>
sfr TMOD <span class="token operator">=</span> <span class="token number">0x89</span><span class="token punctuation">;</span> <span class="token comment">// 定时器模式寄存器地址，用于配置定时器的计数方式和工作模式</span>
sfr TL0 <span class="token operator">=</span> <span class="token number">0x8A</span><span class="token punctuation">;</span> <span class="token comment">// 定时器0低8位的特殊功能寄存器地址，用于定时器计数和计数值的读写</span>
sfr TL1 <span class="token operator">=</span> <span class="token number">0x8B</span><span class="token punctuation">;</span> <span class="token comment">// 定时器1低8位的特殊功能寄存器地址，用于定时器计数和计数值的读写</span>
sfr TH0 <span class="token operator">=</span> <span class="token number">0x8C</span><span class="token punctuation">;</span> <span class="token comment">// 定时器0高8位的特殊功能寄存器地址，用于定时器计数和计数值的读写</span>
sfr TH1 <span class="token operator">=</span> <span class="token number">0x8D</span><span class="token punctuation">;</span> <span class="token comment">// 定时器1高8位的特殊功能寄存器地址，用于定时器计数和计数值的读写</span>
sfr IE <span class="token operator">=</span> <span class="token number">0xA8</span><span class="token punctuation">;</span> <span class="token comment">// 中断控制寄存器地址，用于控制中断的使能和优先级</span>
sfr IP <span class="token operator">=</span> <span class="token number">0xB8</span><span class="token punctuation">;</span> <span class="token comment">// 中断优先级寄存器地址，用于设置中断的优先级</span>
sfr SCON <span class="token operator">=</span> <span class="token number">0x98</span><span class="token punctuation">;</span> <span class="token comment">// 串行通信控制寄存器地址，用于控制串行通信的参数和状态</span>
sfr SBUF <span class="token operator">=</span> <span class="token number">0x99</span><span class="token punctuation">;</span> <span class="token comment">// 串行通信数据缓存寄存器地址，用于存储串行通信的数据</span>
<span class="token comment">/* 8052 Extensions */</span>
sfr T2CON <span class="token operator">=</span> <span class="token number">0xC8</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2控制寄存器地址，用于控制定时器2的工作模式和计数器的值</span>
sfr RCAP2L <span class="token operator">=</span> <span class="token number">0xCA</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2重载值低8位的特殊功能寄存器地址</span>
sfr RCAP2H <span class="token operator">=</span> <span class="token number">0xCB</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2重载值高8位的特殊功能寄存器地址</span>
sfr TL2 <span class="token operator">=</span> <span class="token number">0xCC</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2低8位计数器的特殊功能寄存器地址</span>
sfr TH2 <span class="token operator">=</span> <span class="token number">0xCD</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2高8位计数器的特殊功能寄存器地址</span>
<span class="token comment">/* BIT Registers */</span>
<span class="token comment">/* PSW */</span>
sbit CY <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// PSW（程序状态字）中进位标志位</span>
sbit AC <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// PSW中辅助进位标志位</span>
sbit F0 <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// PSW中用户可编程标志位0</span>
sbit RS1 <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// PSW中寄存器组选择位1</span>
sbit RS0 <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// PSW中寄存器组选择位0</span>
sbit OV <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// PSW中溢出标志位</span>
sbit P <span class="token operator">=</span> PSW<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// PSW中奇偶校验位，只有8052芯片才有此标志位</span>
<span class="token comment">/* TCON 位控制器的定义*/</span>
sbit TF1 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 7 为 TF1，用于控制定时器 1 溢出标志</span>
sbit TR1 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 6 为 TR1，用于控制定时器 1 运行控制</span>
sbit TF0 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 5 为 TF0，用于控制定时器 0 溢出标志</span>
sbit TR0 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 4 为 TR0，用于控制定时器 0 运行控制</span>
sbit IE1 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 3 为 IE1，用于控制外部中断 1 使能</span>
sbit IT1 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 2 为 IT1，用于控制外部中断 1 触发方式</span>
sbit IE0 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 1 为 IE0，用于控制外部中断 0 使能</span>
sbit IT0 <span class="token operator">=</span> TCON<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 定义 TCON SFR 的位 0 为 IT0，用于控制外部中断 0 触发方式</span>
<span class="token comment">/* IE */</span>
sbit EA <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>     <span class="token comment">// 定义 IE SFR 的位 7 为 EA，用于控制全局中断使能</span>
sbit ET2 <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IE SFR 的位 5 为 ET2，仅适用于 8052，用于控制定时器 2 中断使能</span>
sbit ES <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">// 定义 IE SFR 的位 4 为 ES，用于控制串行口中断使能</span>
sbit ET1 <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IE SFR 的位 3 为 ET1，用于控制定时器 1 中断使能</span>
sbit EX1 <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IE SFR 的位 2 为 EX1，用于控制外部中断 1 中断使能</span>
sbit ET0 <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IE SFR 的位 1 为 ET0，用于控制定时器 0 中断使能</span>
sbit EX0 <span class="token operator">=</span> IE<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IE SFR 的位 0 为 EX0，用于控制外部中断 0 中断使能</span>
<span class="token comment">/* IP */</span>
sbit PT2 <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>    <span class="token comment">// 定义 IP SFR 的位 5 为 PT2，仅适用于 8052，用于控制定时器 2 中断优先级</span>
sbit PS <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>     <span class="token comment">// 定义 IP SFR 的位 4 为 PS，用于控制串行口中断优先级</span>
sbit PT1 <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器 1 中断优先级</span>
sbit PX1 <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// 外部中断 1 优先级</span>
sbit PT0 <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器 0 中断优先级</span>
sbit PX0 <span class="token operator">=</span> IP<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 外部中断 0 优先级</span>
<span class="token comment">/* P3 - 端口3 */</span>
sbit RD <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>   <span class="token comment">// 外部存储器读取</span>
sbit WR <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>   <span class="token comment">// 外部存储器写入</span>
sbit T1 <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">// 定时器1计数器输入</span>
sbit T0 <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">// 定时器0计数器输入</span>
sbit INT1 <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 外部中断1输入</span>
sbit INT0 <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 外部中断0输入</span>
sbit TXD <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 串口发送端口</span>
sbit RXD <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 串口接收端口</span>

<span class="token comment">/* SCON - 串口控制寄存器 */</span>
sbit SM0 <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span> <span class="token comment">// 串口工作方式选择位0</span>
sbit SM1 <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 串口工作方式选择位1</span>
sbit SM2 <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment">// 9位数据模式选择 (仅适用于特殊硬件)</span>
sbit REN <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 串口接收使能</span>
sbit TB8 <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 发送的第9位数据 (仅适用于特殊硬件)</span>
sbit RB8 <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 接收的第9位数据 (仅适用于特殊硬件)</span>
sbit TI <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 串口发送中断标志</span>
sbit RI <span class="token operator">=</span> SCON<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// 串口接收中断标志</span>

<span class="token comment">/* P1 - 端口1 */</span>
sbit T2EX <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2计数器的外部时钟输入 (仅适用于8052)</span>
sbit T2 <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">// 定时器2计数器输入 (仅适用于8052)</span>

<span class="token comment">/* T2CON - 定时器2控制寄存器 */</span>
sbit TF2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>   <span class="token comment">// 定时器2溢出标志</span>
sbit EXF2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器2外部脉冲标志</span>
sbit RCLK <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器2的外部时钟选择</span>
sbit TCLK <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器2的计数时钟选择</span>
sbit EXEN2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2的外部计数使能</span>
sbit TR2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">// 定时器2的计数控制位</span>
sbit C_T2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 定时器2的工作方式选择位</span>
sbit CP_RL2 <span class="token operator">=</span> T2CON<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 定时器2的模式选择位</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></div></details> <h3 id="什么是串口-端口-i-o-口"><a href="#什么是串口-端口-i-o-口" class="header-anchor">#</a> 什么是串口，端口，I/O 口？</h3> <p>串口是一种通过串行传输方式实现数据通信的接口，它通常包括两个信号线：一个是数据线，用于传输数据；另一个是时钟线，用于同步数据传输。串口可以连接各种外设，例如打印机、鼠标、调制解调器等等。</p> <p>端口是一种物理接口，用于连接外部设备到计算机系统，通常由多个引脚组成。计算机通过端口与外设进行数据交换。在计算机中，通常将端口分为输入端口和输出端口，输入端口用于从外部设备读取数据，输出端口用于向外部设备发送数据。</p> <p>I/O 口（Input/Output Port）则是一种用于输入输出的通用接口，它通常由多个引脚组成，可以用于输入输出各种类型的信号。I/O 口可以通过编程控制来实现与外部设备的数据交换，例如读取传感器数据、控制 LED 灯等等。</p> <h3 id="什么是串行传输"><a href="#什么是串行传输" class="header-anchor">#</a> 什么是串行传输？</h3> <p>串行传输方式是一种将数据比特一个接一个地传输的数据传输方式。在串行传输中，每个数据比特按照一定的时间间隔一个接一个地通过单根传输线传输。因为数据是按照顺序传输的，所以在接收端可以比较容易地重新组装成完整的数据。</p> <p>相比较于并行传输方式（将多个数据比特同时传输），串行传输方式在使用线缆、连接器和外部设备等方面具有更低的成本，也可以更容易地扩展到更高的速度和更远的距离。</p> <p>串行传输方式在计算机和通信领域广泛应用。例如，串口通信、以太网和 USB 等都是串行传输方式。在数字信号处理中，一些数字信号接口（如 SPI 和 I2C）也使用串行传输方式。</p> <h2 id="实践-点亮多个-led-灯"><a href="#实践-点亮多个-led-灯" class="header-anchor">#</a> 实践：点亮多个 LED 灯</h2> <p>点亮一个 LED 灯，我们可以通过让其连接的 I/O 口 引脚为低电平来实现，但如果要一次性点亮多个 LED 灯时怎么办？你可能会选择挨个把引脚设置为低电平。但这样的方法比较麻烦，用下面的方法，只用一行代码就可以点亮多个 LED 灯</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入引脚命名的头文件</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	P2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//将P2端口设置为低电平</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>P2 端口共有 8 个引脚，如果直接将 P2 端口设置为低电平，就相当于把该端口的全部引脚都设为低电平</strong>。为了能更加清除的解释背后的原理我们一般使用 十六进制 的方式，如下</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入引脚命名的头文件</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	P2 <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">;</span><span class="token comment">//将P2端口设置为低电平(十六进制)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>在十六进制中 <code>0x0</code> 表示 <code>0000 0000</code>（二进制形式）这表示八个引脚都为低电平</li> <li><strong>使用十六进制可以更加灵活的控制各个引脚</strong>。例如，<strong>让第二个引脚和第五个引脚的灯不亮，其他灯都亮。这时只需要让第二个引脚和第五个引脚都为高电平，其他引脚都为低电平即可</strong>，用二进制表示为 <code>0001 0010</code>，用十六进制表示为 <code>0x12</code></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入引脚命名的头文件</span></span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	P2 <span class="token operator">=</span> <span class="token number">0x12</span><span class="token punctuation">;</span><span class="token comment">//P2端口输出 0001 0010</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样除了第二个引脚 <code>P2^1</code> 和第五个引脚 <code>P2^4</code> 的灯不亮以外，其他 <strong>P2</strong> 端口引脚的灯都会亮</p> <h2 id="实践-led-闪烁"><a href="#实践-led-闪烁" class="header-anchor">#</a> 实践：LED 闪烁</h2> <p>要实现一个 LED 闪烁的效果需要四个步骤：</p> <ol><li>点亮 LED</li> <li>等待一秒</li> <li>熄灭 LED</li> <li>再等待一秒</li></ol> <p>然后循环以上过程，代码如下</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入引脚命名的头文件</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//给P2.0引脚命名为LED</span>
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    LED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为低电平</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时等待</span>
    LED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为高电平</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时等待</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>但现在这些代码现在并不能运行</strong>，因为代码中还没有写入实现等待一秒的函数 <code>delay()</code>，如何实现延时功能呢？</p> <p>其实单片机是按照一定的频率运行的，这种频率叫做 <strong>时钟频率</strong> 这是单片机中的晶振结合内部电路所提供的，<strong>晶振的提供的时钟频率越高，那单片机的运行速度也就越快。</strong> 既然如此，单片机运行每一段代码都需要花费一定的时间，那我们就可以制造一个程序来占用单片机运行的时间，从而实现延时的效果。通常会使用循环来实现这种效果</p> <p>举一个完整的例子：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;reg52.h&quot;</span><span class="token comment">//引入引脚命名的头文件</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//给P2.0引脚命名为LED</span>

<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span>count<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//一直循环</span>
  <span class="token punctuation">{</span>
    LED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为低电平</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时等待</span>
    LED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为高电平</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时等待</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>while()</code> 中的 1 表示真，0 表示假，<code>while(1)</code> 则表示循环总是成立，所以循环会一直进行</li></ul> <p><code>delay()</code>是一个延时函数，编写一个延时函数要考虑的因素很多，例如晶振频率，定时长度，指令集类型等，所以编写一个延时函数非常麻烦，但在软件 <strong>stc-isp</strong> 中有一个功能叫 <strong>软件延时计算器</strong> ，可以帮助你<strong>生成延时代码</strong> ，或者在网络上搜索单片机延时相关的代码</p> <p><strong>以下是一段的间隔一秒闪烁 LED 灯的代码</strong>，其中延时函数<code>Delay1000ms</code>是就是用<strong>stc-isp</strong>生成的，你可以把程序直接烧录在单片机中验证。注意：LED 灯正极接 VCC，负极接引脚 P20</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrins.h&gt;</span><span class="token comment">// 引入文件声明void _nop_(void);</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//给P2.0引脚命名为LED</span>

<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">Delay1000ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//@11.0592MHz</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	i <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	k <span class="token operator">=</span> <span class="token number">243</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">do</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
		LED <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为低电平</span>
		<span class="token function">Delay1000ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等待一秒</span>
		LED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//将引脚P2^0设置为高电平</span>
		<span class="token function">Delay1000ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等待一秒</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实践-流水灯"><a href="#实践-流水灯" class="header-anchor">#</a> 实践：流水灯</h2> <p>在 LED 闪烁的基础上，使用 for 循环，让闪烁动起来，形成流水灯。具体实现看代码</p> <div class="language-c extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;intrins.h&gt;</span><span class="token comment">// 声明了void _nop_(void);</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//给P2.0引脚命名为LED</span>

<span class="token comment">//延时函数,延时200ms</span>
<span class="token keyword">void</span> <span class="token function">Delay200ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//@11.0592MHz</span>
<span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">;</span>
	<span class="token function">_nop_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> j <span class="token operator">=</span> <span class="token number">103</span><span class="token punctuation">;</span> k <span class="token operator">=</span> <span class="token number">147</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span><span class="token punctuation">{</span><span class="token keyword">do</span><span class="token punctuation">{</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	P2<span class="token operator">=</span><span class="token operator">~</span><span class="token number">0x01</span><span class="token punctuation">;</span> <span class="token comment">// 0000 0001 取反为 1111 1110</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment">//总是循环</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token comment">//循环8次，每次循环i递增1知道i=8时停止循环</span>
		<span class="token punctuation">{</span>
			P2<span class="token operator">=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x01</span> <span class="token operator">&lt;&lt;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 移位运算 0000 0001 —&gt; 0000 0010</span>
			<span class="token function">Delay200ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时200ms</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实践-按键的使用"><a href="#实践-按键的使用" class="header-anchor">#</a> 实践：按键的使用</h2> <p>让我们通过按键来控制 LED 灯的亮灭，以此为例来学习按键的使用</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E6%8C%89%E9%94%AE%E7%9A%84%E4%BD%BF%E7%94%A8%E7%94%B5%E8%B7%AF%E7%A4%BA%E6%84%8F%E5%9B%BE.png" alt="按键的使用电路示意图"></p> <p>以上是电路的连接示意图</p> <ul><li>给 LED 灯串联一个电阻是为了保护 LED 灯不被烧毁，有些 LED 灯无法承受 5V 的电压，这对它们来说有点大，所以需要电阻来分走一部分电压</li> <li>按键的一端要接地线，因为<strong>51 单片机的引脚默认具有高电平</strong>，当按键按下时电路接地，电压降为低电平，现在<strong>只需要判断 P10 引脚是否为低电平就可以知道按键是否被按下</strong></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//LED灯接引脚 P2.0</span>
sbit KEY <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//按键接引脚P 1.0</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//一直判断按键是否按下</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//判断按键是否按下</span>
		<span class="token punctuation">{</span>
			LED <span class="token operator">=</span> <span class="token operator">~</span>LED<span class="token punctuation">;</span> <span class="token comment">//取反操作,如果灯泡亮则熄灭灯泡;如果灯泡灭则点亮灯泡</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>KEY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如果按键松开则继续进行循环</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="按键抖动问题"><a href="#按键抖动问题" class="header-anchor">#</a> 按键抖动问题</h3> <p><strong>当按键按下时，活动触点击打固定触点会产生机械振动，因而造成输出波形抖动，这会影响开关使用的稳定性，可能造成按键灵时不灵的情况</strong>，波形对比如下</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E6%8C%89%E9%94%AE%E9%97%AD%E5%90%88%E6%B3%A2%E5%BD%A2.svg" alt="按键闭合波形"></p> <p>我们可以<strong>使用延时函数来解决按键抖动问题</strong>。<strong>通过延时函数可以让程序等按键抖动结束后再对按键进行是否按下的判断</strong>，这时按键闭合稳定，判断不受物理因素干扰。</p> <p>因按键形态和触点材料的不同，抖动的过程一般会持续数毫秒，<strong>金属触点的按键可能达到 10ms</strong>，而软性触点（如导电橡胶或薄膜）则可能在 1ms 以内，所以<strong>延时函数要高于这个时间</strong>。但也不能太高，不然会造成反应过慢的情况。</p> <p>除了从程序上消除按键抖动的办法外，我们还可以通过物理方法实现按键的消抖。例如，在电路中增加滤波电容</p> <h3 id="通过按键控制-led-灯亮灭"><a href="#通过按键控制-led-灯亮灭" class="header-anchor">#</a> 通过按键控制 LED 灯亮灭</h3> <div class="language-c extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//LED灯接引脚 P20</span>
sbit KEY <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//按键接引脚 P10</span>

<span class="token comment">//延时函数</span>
<span class="token keyword">void</span> <span class="token function">Delay50ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//@11.0592MHz</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">163</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//设置灯泡初始状态为熄灭</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//一直判断按键是否按下</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KEY <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//判断按键是否按下</span>
		<span class="token punctuation">{</span>
			<span class="token function">Delay50ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延时,解决按键抖动问题</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>KEY <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//判断按键是否按下</span>
			<span class="token punctuation">{</span>
				LED <span class="token operator">=</span> <span class="token operator">~</span>LED<span class="token punctuation">;</span> <span class="token comment">//取反操作,如果灯泡亮则熄灭灯泡;如果灯泡灭则点亮灯泡</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>KEY<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//判断按键是否松开,如果松开则继续进行循环</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何实现按下按钮时-led-灯熄灭-松开按钮后-led-灯点亮"><a href="#如何实现按下按钮时-led-灯熄灭-松开按钮后-led-灯点亮" class="header-anchor">#</a> 如何实现按下按钮时 LED 灯熄灭，松开按钮后 LED 灯点亮？</h3> <p>最简单的方法就是让 LED 的状态等于按键的状态</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>

sbit LED <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//LED灯接引脚 P20</span>
sbit KEY <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//按键接引脚 P10</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LED <span class="token operator">=</span> KEY<span class="token punctuation">;</span> <span class="token comment">//LED状态等于按键状态</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="实践-用矩阵键盘控制-lcd1602-屏幕的显示"><a href="#实践-用矩阵键盘控制-lcd1602-屏幕的显示" class="header-anchor">#</a> 实践：用矩阵键盘控制 LCD1602 屏幕的显示</h2> <p>要实现用矩阵键盘控制 LCD1602 屏幕的显示，需要先学习矩阵按键和 LCD1602 的使用，所以先从这两个外设开始讲起</p> <h3 id="矩阵键盘"><a href="#矩阵键盘" class="header-anchor">#</a> 矩阵键盘</h3> <p>矩阵键盘是一种常见的电子键盘，由多个按键排列组成。<strong>它的原理是将按键排列成一个行列矩阵，通过扫描矩阵的行和列，检测按键的按下和释放状态。</strong></p> <p>具体来说，矩阵键盘的每个按键都被分配了一个唯一的行列坐标，这些坐标按照行列排列成一个矩阵。<strong>当按键未被按下时，该按键所在的行列处于高电平状态；当按键被按下时，该按键所在的行列会产生短暂的低电平信号</strong>。<strong>为了检测按键状态，矩阵键盘需要不断扫描矩阵的行和列，以检测低电平信号</strong>。</p> <p>矩阵键盘的<strong>优点</strong>是可以<strong>减少输入设备的引脚数量</strong>，从而降低成本，同时也可以实现较高的响应速度。<strong>缺点</strong>是<strong>会受到按键反应速度和扫描速度的限制</strong>，因此在某些高速应用场合可能不够理想。</p> <p><strong>矩阵键盘原理图如下</strong>：</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E7%9F%A9%E9%98%B5%E9%94%AE%E7%9B%98%E5%8E%9F%E7%90%86%E5%9B%BE.png" alt="矩阵键盘原理图"></p> <h3 id="行列扫描法"><a href="#行列扫描法" class="header-anchor">#</a> 行列扫描法</h3> <p>矩阵键盘上有许多按键，<strong>通过判断按下按键的行和列来确定按下的是哪个按键，这种方法就是行列扫描法</strong>，具体代码如下</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> Key<span class="token punctuation">;</span> <span class="token comment">//设置变量Key，用于储存键值</span>

P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span> <span class="token comment">//把P1端口的8位引脚设置为 0000 1111 (从右向左数)，准备进行列扫描</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>P1 <span class="token operator">!=</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">Delay10ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//延时10ms</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>P1 <span class="token operator">!=</span> <span class="token number">0x0f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//扫描列</span>
        P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>P1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0x0e</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//0000 1110 第1列的按键被按下</span>
                Key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//0000 1101 第2列的按键被按下</span>
                Key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0x0b</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//0000 1011 第3列的按键被按下</span>
                Key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0x07</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//0000 0111 第4列的按键被按下</span>
                Key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//扫描行</span>
        P1 <span class="token operator">=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">//把P1端口的8位引脚设置为 1111 0000 准备开始行扫描</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>P1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//0111 0000 第1行的按键被按下</span>
                Key <span class="token operator">=</span> Key <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0xb0</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//1011 0000 第1行的按键被按下</span>
                Key <span class="token operator">=</span> Key <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0xd0</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//1101 0000 第2行的按键被按下</span>
                Key <span class="token operator">=</span> Key <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token punctuation">(</span><span class="token number">0xe0</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//1110 0000 第1行的按键被按下</span>
                Key <span class="token operator">=</span> Key<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>P1 <span class="token operator">==</span> <span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>高四位表示<strong>行</strong>，低四位表示<strong>列</strong></li> <li>有了以上代码后，后续只需要根据变量 Key 的值来判断按下的是哪个按键，例如，按下按键 S4 后变量<code>Key = 4</code></li></ul> <h3 id="lcd1602-工作原理"><a href="#lcd1602-工作原理" class="header-anchor">#</a> LCD1602 工作原理</h3> <p>LCD1602 屏幕最下面是一层 LED 背光板，给他接上电它就可以发光，在它的上面整齐排列这一堆小块液晶，这些液晶就是屏幕显示的像素，按照 2×16 排列 所以叫 LCD&quot;1602&quot;(16×02)，LCD 表示（Liquid Crystal Display）液晶显示屏。这些像素共有 32 个部分，每个部分都由 35 个小块液晶(5×7)组成当液晶没有施加电压时它几乎透明，但当给某一块液晶施加电压后它就不透光了，因此形成了一个正方形的小黑点，我们只需要控制每个像素的电压就可以在屏幕上用这些像素形成各种图案。</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/LCD1602%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E9%85%8D%E5%9B%BE.png" alt="名称"></p> <p>但这块小小的屏幕却有 1120 个像素，如果每个像素都让单片机控制则需要 1120 个引脚，由于需要的引脚太多，所以人类开发了一个名为 HD44780U 的显示芯片，这个芯片有 80 个引脚，通过这个芯片我们就可以控制 LCD1602 的每一个像素。一般这些芯片会封装在 LCD1602 模块的电路板背部，不需要单独购买，由于像素数量的限制这块屏幕只能显示数字，字母和一些简单的符号，一共能显示 240 种字符，这些符号由<a href="/c/参考.html#ascii码">ASCII 码</a>进行编码，由八位二进制的数据表示，所以它需要八根数据引脚（D0~D7）传输数据，一般情况下会先发送一个显存地址，来告诉 LCD1602 数据显示的区域，然后再发送要在这块区域显示的字符的 ASCII 码，这样字符就会显示在那个区域</p> <blockquote><p><strong>视频推荐</strong></p> <p><a href="https://www.bilibili.com/video/BV1tG4y1L7Um/?share_source=copy_web&amp;vd_source=f593b5be3aefe519cea20d1a5086e5bb" target="_blank" rel="noopener noreferrer">再简单的屏幕也需要显卡！让你彻底看懂 LCD 屏的控制原理！1602A LCD 的工作原理！<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="lcd1602-的使用"><a href="#lcd1602-的使用" class="header-anchor">#</a> LCD1602 的使用</h3> <p>为了更方便的使用 LCD1602 屏幕，可以在程序中引入函数库 <strong>LCD1602.c</strong></p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;LCD1602.h&quot;</span> <span class="token comment">//引入LCD1602函数库头文件</span></span>
</code></pre></div><p>引入函数库前要先在项目文件中添加以下两个文件（添加在根目录即可）</p> <details class="custom-block details"><summary>LCD1602.h</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__LCD1602_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__LCD1602_H__</span></span>

<span class="token comment">//用户调用函数：</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre></div></details> <details class="custom-block details"><summary>LCD1602.c</summary> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>

<span class="token comment">//引脚配置：</span>
sbit LCD_RS<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>
sbit LCD_RW<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>
sbit LCD_EN<span class="token operator">=</span>P2<span class="token operator">^</span><span class="token number">7</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DataPort</span> <span class="token expression">P0</span></span>

<span class="token comment">//函数定义：</span>
<span class="token comment">/**
  * @brief  LCD1602延时函数，12MHz调用可延时1ms
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">239</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写命令
  * @param  Command 要写入的命令
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Command<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LCD_RS<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Command<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602写数据
  * @param  Data 要写入的数据
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	LCD_RS<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	LCD_RW<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	LCD_DataPort<span class="token operator">=</span>Data<span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LCD_EN<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token function">LCD_Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602设置光标位置
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>Line<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token operator">|</span><span class="token punctuation">(</span>Column<span class="token operator">-</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  LCD1602初始化函数
  * @param  无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//八位数据接口，两行显示，5*7点阵</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x0c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示开，光标关，闪烁关</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x06</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//数据读写操作后，光标自动加一，画面不动</span>
	<span class="token function">LCD_WriteCommand</span><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//光标复位，清屏</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置上显示一个字符
  * @param  Line 行位置，范围：1~2
  * @param  Column 列位置，范围：1~16
  * @param  Char 要显示的字符
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowChar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> Char<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Char<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给字符串
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  String 要显示的字符串
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>String<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  返回值=X的Y次方
  */</span>
<span class="token keyword">int</span> <span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token keyword">int</span> X<span class="token punctuation">,</span><span class="token keyword">int</span> Y<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">int</span> Result<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>Y<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		Result<span class="token operator">*=</span>X<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> Result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~65535
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以有符号十进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：-32768~32767
  * @param  Length 要显示数字的长度，范围：1~5
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowSignedNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number1<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>Number<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span><span class="token char">'-'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		Number1<span class="token operator">=</span><span class="token operator">-</span>Number<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number1<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以十六进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~0xFFFF
  * @param  Length 要显示数字的长度，范围：1~4
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowHexNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span>SingleNumber<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		SingleNumber<span class="token operator">=</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">16</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>SingleNumber<span class="token operator">-</span><span class="token number">10</span><span class="token operator">+</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief  在LCD1602指定位置开始以二进制显示所给数字
  * @param  Line 起始行位置，范围：1~2
  * @param  Column 起始列位置，范围：1~16
  * @param  Number 要显示的数字，范围：0~1111 1111 1111 1111
  * @param  Length 要显示数字的长度，范围：1~16
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">LCD_ShowBinNum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Line<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Column<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> Number<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Length<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token function">LCD_SetCursor</span><span class="token punctuation">(</span>Line<span class="token punctuation">,</span>Column<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span>Length<span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">LCD_WriteData</span><span class="token punctuation">(</span>Number<span class="token operator">/</span><span class="token function">LCD_Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">2</span><span class="token operator">+</span><span class="token char">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></details> <details class="custom-block details"><summary>LCD1602.c 函数库常用函数说明</summary> <table><thead><tr><th>函数</th> <th>参数</th> <th>说明</th></tr></thead> <tbody><tr><td><code>LCD_Init()</code></td> <td></td> <td>初始化函数</td></tr> <tr><td><code>LCD_ShowChar(Line,Column,Char)</code></td> <td><code>Line</code> 行位置<br><code>Column</code> 列位置<br><code>Char</code> 字符</td> <td>在指定位置上显示一个字符</td></tr> <tr><td><code>LCD_ShowString(Line,Column,String)</code></td> <td><code>Line</code> 起始行位置<br><code>Column</code> 起始行位置<br><code>String</code> 要显示的字符串</td> <td>在指定位置开始显示所给字符串</td></tr> <tr><td><code>LCD_ShowNum(Line,Column,Number,Length)</code></td> <td><code>Line</code> 起始行位置<br><code>Column</code> 起始行位置<br><code>String</code> 要显示的数字<br><code>Length</code> 数字的长度</td> <td>在指定位置开始显示所给数字</td></tr> <tr><td><code>LCD_ShowSignedNum(Line,Column,Number,Length)</code></td> <td><code>Line</code> 起始行位置<br><code>Column</code> 起始行位置<br><code>String</code> 要显示的数字<br><code>Length</code> 数字的长度</td> <td>在指定位置以有符号的十进制形式显示所给数字</td></tr> <tr><td><code>LCD_ShowHexNum(Line,Column,Number,Length)</code></td> <td><code>Line</code> 起始行位置<br><code>Column</code> 起始行位置<br><code>String</code> 要显示的数字<br><code>Length</code> 数字的长度</td> <td>在指定位置开始以十六进制的形式显示所给数字</td></tr> <tr><td><code>LCD_ShowBinNum(Line,Column,Number,Length)</code></td> <td><code>Line</code> 起始行位置<br><code>Column</code> 起始行位置<br><code>String</code> 要显示的数字<br><code>Length</code> 数字的长度</td> <td>在指定位置开始以二进制的形式显示所给数字</td></tr> <tr><td><code>LCD_SetCursor(Line,Column)</code></td> <td><code>Line</code> 行位置<br><code>Column</code> 列位置</td> <td>设置光标的位置</td></tr></tbody></table></details> <p>然后根据以下原理图连接电路和单片机</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/LCD1602%E6%8E%A5%E7%BA%BF%E5%9B%BE.png" alt="LCD1602接线图"></p> <p><strong>LCD1602 共有 16 个引脚，其各个引脚的作用如下：</strong></p> <ul><li><strong>VSS</strong>：地线</li> <li><strong>VDD</strong>：电源引脚，通常接 5V 电源。</li> <li><strong>V0</strong>：液晶对比度调整引脚，通过调节电压大小来调整液晶的对比度。一般接一个可变电阻来调节，电阻两端接 VDD 和 GND，中间接 V0 引脚。</li> <li><strong>RS</strong>：寄存器选择引脚，用于选择数据寄存器（RS=1）或指令寄存器（RS=0）。</li> <li><strong>RW</strong>：读写选择引脚，用于选择读操作（RW=1）或写操作（RW=0）。</li> <li><strong>E</strong>：使能引脚，用于启动数据传输。</li> <li><strong>D0-D7</strong>：数据引脚，用于传输 8 位并行数据。</li> <li><strong>A</strong>：LED 背光板正极引脚。</li> <li><strong>K</strong>：LED 背光板负极引脚。</li></ul> <h3 id="程序-根据按键在-lcd1602-屏幕显示内容"><a href="#程序-根据按键在-lcd1602-屏幕显示内容" class="header-anchor">#</a> 程序：根据按键在 LCD1602 屏幕显示内容</h3> <p>这就是该程序的全部代码，现在阅读每一行代码后的注释，并把它烧录在单片机中试试吧</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;reg52.h&gt;</span><span class="token comment">// 引入引脚命名的头文件</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;LCD1602.h&quot;</span> <span class="token comment">//引入操作LCD1602的函数库</span></span>

<span class="token keyword">void</span> <span class="token function">Delay10ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token comment">//@11.0592MHz</span>
<span class="token punctuation">{</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> j<span class="token punctuation">;</span>

	i <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
	j <span class="token operator">=</span> <span class="token number">235</span><span class="token punctuation">;</span>
	<span class="token keyword">do</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> Key<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Key_onclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//判断矩阵键盘按键</span>
<span class="token punctuation">{</span>
	P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span> <span class="token comment">//0000 1111</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P1 <span class="token operator">!=</span> <span class="token number">0x0f</span> <span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">Delay10ms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时10ms</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>P1 <span class="token operator">!=</span> <span class="token number">0x0f</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token comment">//扫描列</span>
				P1 <span class="token operator">=</span> <span class="token number">0x0f</span><span class="token punctuation">;</span>
				<span class="token keyword">switch</span><span class="token punctuation">(</span>P1<span class="token punctuation">)</span>
					<span class="token punctuation">{</span>
					<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0x0e</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//0000 1110 第1列的按键被按下</span>
						Key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//0000 1101 第2列的按键被按下</span>
						Key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0x0b</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//0000 1011 第3列的按键被按下</span>
						Key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0x07</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//0000 0111 第4列的按键被按下</span>
						Key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">//扫描行</span>
					P1 <span class="token operator">=</span> <span class="token number">0xf0</span><span class="token punctuation">;</span>
					<span class="token keyword">switch</span><span class="token punctuation">(</span>P1<span class="token punctuation">)</span>
						<span class="token punctuation">{</span>
						<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0x70</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//0111 0000 第1行的按键被按下</span>
							Key <span class="token operator">=</span> Key <span class="token operator">+</span><span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0xb0</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//1011 0000 第1行的按键被按下</span>
							Key <span class="token operator">=</span> Key <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0xd0</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//1101 0000 第2行的按键被按下</span>
							Key <span class="token operator">=</span> Key <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">0xe0</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token comment">//1110 0000 第1行的按键被按下</span>
							Key <span class="token operator">=</span> Key<span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span>P1 <span class="token operator">==</span> <span class="token number">0xf0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//LCD初始化</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">Key_onclick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用判断矩阵键盘按键的函数</span>
		<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Key<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从屏幕第一行第一列开始显示数字(Key的值)，数字位数设置为3位</span>
		<span class="token keyword">switch</span><span class="token punctuation">(</span>Key<span class="token punctuation">)</span><span class="token comment">//根据变量Key判断按下的是哪个按键</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//当按下S1时</span>
				<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Hello!Yoseya    &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//当按下S2时</span>
				<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Hello!Peter     &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//当按下S3时</span>
				<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Hello!Tom       &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token keyword">case</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token comment">//当按下S4时</span>
				<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;Hello!World     &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="定时器与中断"><a href="#定时器与中断" class="header-anchor">#</a> 定时器与中断</h2> <p>如何用单片机制作一个定时器？如何让单片机获得定时的能力？这些都需要晶体振荡器的参与，俗称晶振。晶振按照固定频率振动，通过它的这种性质就可以实现计时，具体实现方法如下</p> <h3 id="定时器原理"><a href="#定时器原理" class="header-anchor">#</a> 定时器原理</h3> <p><strong>在存储器中指定一个固定的存储空间，用于计数，并连接外部的晶体振荡器电路（OSC），晶振每震荡一次就会产生一个周期的方波，这时存储器中计数加一，由于晶振震荡周期是固定的，所以正好可以用于计时。</strong></p> <p>在 51 单片机中有一个分频器默认为 12 分频，分频后的信号传给“计数器”进行计数，这里的计数器就是用于计数的存储器单元，为了读取更加便捷，所以它被单独设计为特殊功能寄存器，他有两个字节的空间，这两字节分别为 <mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="3.787ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1674 840.8" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z" style="stroke-width:3;"></path><path data-c="4C" d="M128 622Q121 629 117 631T101 634T58 637H25V683H36Q48 680 182 680Q324 680 348 683H360V637H333Q273 637 258 635T233 622L232 342V129Q232 57 237 52Q243 47 313 47Q384 47 410 53Q470 70 498 110T536 221Q536 226 537 238T540 261T542 272T562 273H582V268Q580 265 568 137T554 5V0H25V46H58Q100 47 109 49T128 61V622Z" transform="translate(722,0)" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1380,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>TL</mtext><mi>i</mi></msub></math></mjx-assistive-mml></mjx-container> 和 <mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="4.07ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1799 840.8" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z" style="stroke-width:3;"></path><path data-c="48" d="M128 622Q121 629 117 631T101 634T58 637H25V683H36Q57 680 180 680Q315 680 324 683H335V637H302Q262 636 251 634T233 622L232 500V378H517V622Q510 629 506 631T490 634T447 637H414V683H425Q446 680 569 680Q704 680 713 683H724V637H691Q651 636 640 634T622 622V61Q628 51 639 49T691 46H724V0H713Q692 3 569 3Q434 3 425 0H414V46H447Q489 47 498 49T517 61V332H232V197L233 61Q239 51 250 49T302 46H335V0H324Q303 3 180 3Q45 3 36 0H25V46H58Q100 47 109 49T128 61V622Z" transform="translate(722,0)" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1505,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>TH</mtext><mi>i</mi></msub></math></mjx-assistive-mml></mjx-container> ，这里的 <code>i</code> 可以为 0 也可以为 1，因为在 51 单片机中设有两个功能相同的定时器 0 和 1，所以这里的 <code>i</code> 是通配符，当使用定时器 0 时 <code>i</code> 为 0，使用定时器 1 时 <code>i</code> 为 1</p> <p>如果使用的<strong>晶振频率为 12MHZ</strong> ，经过 <strong>12 分频后输入的频率为 1MHZ</strong>，由<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="6.383ex" height="2.737ex" role="img" focusable="false" viewBox="0 -864.9 2821.4 1209.9" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.781ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(827.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z" style="stroke-width:3;"></path></g><g data-mml-node="mfrac" transform="translate(1883.6,0)"><g data-mml-node="mn" transform="translate(292.1,394) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(220,-345) scale(0.707)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z" style="stroke-width:3;"></path></g><rect width="697.8" height="60" x="120" y="220"></rect></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo>=</mo><mfrac><mn>1</mn><mi>T</mi></mfrac></math></mjx-assistive-mml></mjx-container>得，<strong>振动一个周期的时间为 1μs</strong> ，所以<strong>每经过 1μs 计数器中的值 <code>+1</code></strong>，<strong>想要知道过去多长时间只需要判断计数器中的数即可，如果计数器中的值为<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="7.147ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 3159 886" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(1722.4,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1033,393.1) scale(0.707)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" style="stroke-width:3;"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>×</mo><msup><mn>10</mn><mn>6</mn></msup></math></mjx-assistive-mml></mjx-container>时则刚好为 1 秒</strong>，但这个计时器大小<strong>只有两个字节</strong>，能存储的最大范围为<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.887ex" role="img" focusable="false" viewBox="0 -833.9 1290.1 833.9" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:0;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" style="stroke-width:3;"></path></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)" style="stroke-width:3;"></path></g></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></msup></math></mjx-assistive-mml></mjx-container>也就是 0~65535 ，计数器所能计到的最大数就是 65535 ，<strong>无法计数到<mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="7.147ex" height="2.005ex" role="img" focusable="false" viewBox="0 -864 3159 886" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z" style="stroke-width:3;"></path></g><g data-mml-node="msup" transform="translate(1722.4,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" style="stroke-width:3;"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)" style="stroke-width:3;"></path></g><g data-mml-node="mn" transform="translate(1033,393.1) scale(0.707)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" style="stroke-width:3;"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>×</mo><msup><mn>10</mn><mn>6</mn></msup></math></mjx-assistive-mml></mjx-container>这个远超于 65536 的数</strong>，<strong>这时就需要使用到标志位 TF</strong> ，TF0 是计数器 0 的标志位，TF1 是计数器 1 的标志位，每当计数器的值到 65535 时<strong>CNT 就会溢出从而触发 TF 标志位，使 TF 标志位从 0 变为 1 ，这时单片机会在一个新寄存器中 <code>+1</code></strong> ，这样就可以扩展计数范围。<strong>除此之外 TF 标志位为 1 后还会触发中断（这部分会在之后的<a href="/electronics/单片机原理.html#中断系统">中断系统</a>中讲解）</strong></p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E5%AE%9A%E6%97%B6%E5%99%A8%E5%8E%9F%E7%90%86.webp" alt="定时器原理"></p> <p><strong>为了更灵活的改变时间基准又不影响系统主频，所以设计了开关 <code>C/T</code> ,C 表示 Counter，T 表示 Timer，“T”上的横杠表示低电平有效，当<code>C/T=0</code>时 CNT 的时钟由 OSC 提供，当<code>C/T=1</code>时 CNT 的时钟由单片机的外部引脚提供</strong>，如果该引脚是 T0 则 T0 就是定时计数器 0 的外部输入端，如果该引脚是 T1 则 T1 就是定时计数器 1 的外部输入端，<strong>通过定时器外部输入端口，我们可以输入任意频率方波</strong>，为了方便的控制 CNT 的计数，前面还要设置一个使能开关，<strong>开关闭合时 CNT 就可以根据时钟源进行计数，开关断开后 CNT 停止工作，这个开关由下面的逻辑电路进行控制，其中 <mjx-container jax="SVG" class="MathJax" style="direction:ltr;position:relative;"><svg xmlns="http://www.w3.org/2000/svg" width="4.038ex" height="1.902ex" role="img" focusable="false" viewBox="0 -683 1785 840.8" aria-hidden="true" style="overflow:visible;min-height:1px;min-width:1px;vertical-align:-0.357ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mtext"><path data-c="54" d="M36 443Q37 448 46 558T55 671V677H666V671Q667 666 676 556T685 443V437H645V443Q645 445 642 478T631 544T610 593Q593 614 555 625Q534 630 478 630H451H443Q417 630 414 618Q413 616 413 339V63Q420 53 439 50T528 46H558V0H545L361 3Q186 1 177 0H164V46H194Q264 46 283 49T309 63V339V550Q309 620 304 625T271 630H244H224Q154 630 119 601Q101 585 93 554T81 486T76 443V437H36V443Z" style="stroke-width:3;"></path><path data-c="52" d="M130 622Q123 629 119 631T103 634T60 637H27V683H202H236H300Q376 683 417 677T500 648Q595 600 609 517Q610 512 610 501Q610 468 594 439T556 392T511 361T472 343L456 338Q459 335 467 332Q497 316 516 298T545 254T559 211T568 155T578 94Q588 46 602 31T640 16H645Q660 16 674 32T692 87Q692 98 696 101T712 105T728 103T732 90Q732 59 716 27T672 -16Q656 -22 630 -22Q481 -16 458 90Q456 101 456 163T449 246Q430 304 373 320L363 322L297 323H231V192L232 61Q238 51 249 49T301 46H334V0H323Q302 3 181 3Q59 3 38 0H27V46H60Q102 47 111 49T130 61V622ZM491 499V509Q491 527 490 539T481 570T462 601T424 623T362 636Q360 636 340 636T304 637H283Q238 637 234 628Q231 624 231 492V360H289Q390 360 434 378T489 456Q491 467 491 499Z" transform="translate(722,0)" style="stroke-width:3;"></path></g><g data-mml-node="mi" transform="translate(1491,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z" style="stroke-width:3;"></path></g></g></g></g></svg><mjx-assistive-mml unselectable="on" display="inline" style="top:0px;left:0px;clip:rect(1px, 1px, 1px, 1px);-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;padding:1px 0px 0px 0px;border:0px;display:block;width:auto;overflow:hidden;"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mtext>TR</mtext><mi>i</mi></msub></math></mjx-assistive-mml></mjx-container> 是定时器的控制位</strong>，<code>TR0</code>控制定时器 0，<code>TR1</code>控制定时器 1 ，<strong>如果想要定时器运行就必须打开 <code>TR</code> 即 <code>TR=1</code></strong>。</p> <p><strong>假设现在定时器控制位为 1 即 <code>TR=1</code></strong> ，<strong>当<code>GATE=0</code> 时</strong>，<strong>或门</strong>输出端<strong>输出高电平</strong>（1）这时定时器使能<strong>开关闭合</strong>；<strong>当 <code>GATE=1</code> 时引脚 <code>INT0</code> 就可以控制定时器使能开关</strong>，<strong>当 <code>INT0</code> 为高电平时，即 <code>INT0=1</code> 时</strong>，<strong>或门</strong>输出端<strong>输出高电平</strong>（1）定时器使能<strong>开关闭合</strong>，<strong>或门</strong>输出端<strong>输出低电平</strong>（0）定时器使能<strong>开关断开</strong></p> <p><strong>CNT 的工作模式由 <code>M0</code> 和 <code>M1</code> 控制</strong>，具体如下表</p> <table><thead><tr><th><code>M0</code></th> <th><code>M1</code></th> <th>工作模式</th></tr></thead> <tbody><tr><td>0</td> <td>0</td> <td>13 位定时器，TL 只用了 5 位，TH8 位全用</td></tr> <tr><td>1</td> <td>0</td> <td>16 为定时器</td></tr> <tr><td>0</td> <td>1</td> <td>8 位自动装载，TL 用于计数，TH 用于保存装载值，TL 溢出后 TH 的值自动装入 TL 内</td></tr> <tr><td>1</td> <td>1</td> <td>定时器 0 为双 8 位定时器，定时器 1 无功能</td></tr></tbody></table> <blockquote><p><strong>参考视频</strong></p> <p><a href="https://www.bilibili.com/video/BV1MY4y1u7eY/?share_source=copy_web&amp;vd_source=f593b5be3aefe519cea20d1a5086e5bb" target="_blank" rel="noopener noreferrer">入坑单片机 -- [12_1]定时器工作原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="中断系统"><a href="#中断系统" class="header-anchor">#</a> 中断系统</h3> <p>之前提到，当 CNT 溢出时 TF 标志位会置为 1 ，从而触发中断。以定时器 0 为例，当 TF0 置 1 后，ET0 闭合，中断总开关 EA 闭合，那么定时器溢出中断请求就会被登记到中断表上，此时单片机就会立即响应中断。</p> <p><strong>响应中断过程：</strong></p> <ul><li>执行中断服务程序</li> <li>硬件自动清除 TF 标志位为 0 ，即 <code>TF=0</code>，防止重复触发中断</li></ul> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E4%B8%AD%E6%96%AD%E7%B3%BB%E7%BB%9F.webp" alt="中断系统"></p> <p>如图，在 51 单片机中共五条中断线路，每个线路都有对应的矢量地址，当有中断触发时程序计数器 PC 会自动跳转到对应的矢量地址处开始执行中断服务程序，那什么是中断服务程序呢？如下表</p> <p><strong>中断服务程序</strong></p> <table><thead><tr><th>中断源</th> <th>矢量地址</th> <th>C 语言中断服务程序接口</th></tr></thead> <tbody><tr><td>INT0</td> <td>0x03</td> <td><code>void INT0_ISR(void) interrupt 0</code></td></tr> <tr><td>TIM0</td> <td>0x0B</td> <td><code>void TIM0_ISR(void) interrupt 1</code></td></tr> <tr><td>INT1</td> <td>0x13</td> <td><code>void INT1_ISR(void) interrupt 2</code></td></tr> <tr><td>TIM1</td> <td>0x1B</td> <td><code>void TIM1_ISR(void) interrupt 3</code></td></tr> <tr><td>UART</td> <td>0x23</td> <td><code>void UART_ISR(void) interrupt 4</code></td></tr></tbody></table> <p>表中的中断服务程序接口其实就是函数头，当触发中断后就会执行该中断对应的函数</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">INT0_ISR</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> interrupt <span class="token number">0</span>
<span class="token punctuation">{</span>
<span class="token comment">//触发中断后执行的程序</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">注意</p> <ul><li><strong>中断服务程序接口的函数名称允许用户自定义</strong></li> <li>中断服务函数数据类型为 viod，<strong>不能带有参数，不能返回值</strong></li> <li>如果打开多个中断服务，<strong>中断服务程序会根据优先级表从上到下依次执行</strong></li> <li><strong>高优先级表中的中断服务不仅可以在低优先级表前执行，还可以打断低优先级中断程序</strong>。通过这种性质可以实现中断函数程序的嵌套</li></ul></div> <p><strong>中断程序执行过程</strong>：</p> <p><img src="/img/%E5%8D%95%E7%89%87%E6%9C%BA/%E4%B8%AD%E6%96%AD%E7%A8%8B%E5%BA%8F%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B.svg" alt="中断程序执行过程"></p> <h3 id="控制位"><a href="#控制位" class="header-anchor">#</a> 控制位</h3> <ul><li>TMOD（Timer Control Mode Register）定时器模式控制寄存器</li> <li>TCON（Timer Control Register）定时器控制寄存器</li> <li>IE（Interrupt Enable Register）中断允许寄存器</li> <li>IP（interrupt priority）中断优先级控制寄存器</li></ul> <table><thead><tr><th>寄存器</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th> <th>地址</th></tr></thead> <tbody><tr><td><strong>TMOD</strong></td> <td>GATE</td> <td>C/T</td> <td>M1</td> <td>M0</td> <td>GATE</td> <td>C/T</td> <td>M1</td> <td>M0</td> <td>0x89</td></tr> <tr><td><strong>TCON</strong></td> <td>TF1</td> <td>TR1</td> <td>TF0</td> <td>TR0</td> <td>IE1</td> <td>IT1</td> <td>IE0</td> <td>IT0</td> <td>0x88</td></tr> <tr><td><strong>IE</strong></td> <td>EA</td> <td>-</td> <td>-</td> <td>ES</td> <td>ET1</td> <td>EX1</td> <td>ET0</td> <td>EX0</td> <td>0xA8</td></tr> <tr><td><strong>IP</strong></td> <td>-</td> <td>-</td> <td>-</td> <td>PS</td> <td>PT1</td> <td>PX1</td> <td>PT0</td> <td>PX0</td> <td>0xB8</td></tr></tbody></table> <div class="custom-block tip"><p class="custom-block-title">注意</p> <ul><li>在定时器模式控制寄存器 <strong>TMOD</strong> 中，高四位控制定时器<code>1</code>，低四位控制定时器<code>0</code></li> <li>在中断允许寄存器 <strong>IE</strong> 中，标志位为<code>1</code>时表示允许，标志位为<code>0</code>时表示禁止</li></ul></div> <blockquote><p><strong>参考视频</strong></p> <p><a href="https://www.bilibili.com/video/BV1YV4y1K72Q/?share_source=copy_web&amp;vd_source=f593b5be3aefe519cea20d1a5086e5bb" target="_blank" rel="noopener noreferrer">入坑单片机 -- [12_2]中断系统<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="实践-制作简单的计时器"><a href="#实践-制作简单的计时器" class="header-anchor">#</a> 实践：制作简单的计时器</h3> <ol><li>要制作计时器首先需要一个显示屏幕，LCD1602 就是一个不错的选择。引脚的连接与之前的一样，具体可以参考：<a href="/electronics/单片机原理.html#lcd1602-的使用">LCD1602 的使用</a></li> <li>在项目中添加文件 <strong>Timer0.c</strong> 和 <strong>Timer0.h</strong>，该文件代码用于配置定时器</li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">//Timer0.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__TIMER0_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__TIMER0_H__</span></span>
<span class="token keyword">void</span> <span class="token function">Timer0Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//Timer0.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token keyword">void</span> <span class="token function">Timer0Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	TMOD <span class="token operator">&amp;=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span> <span class="token comment">//设置定时器模式</span>
	TMOD <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span> <span class="token comment">//设置定时器模式</span>
	TL0 <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">;</span> <span class="token comment">//设置定时初值</span>
	TH0 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span> <span class="token comment">//设置定时初值</span>
	TF0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//清除TF0标志</span>
	TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//定时器0开始计时</span>
	ET0<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//定时器0中断允许</span>
	PT0<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//中断服务低优先级</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>编写主程序 <strong>main.c</strong></li></ol> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;LCD1602.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;Timer0.h&quot;</span></span>

<span class="token comment">//设置变量时分秒，初始为0</span>
<span class="token keyword">int</span> Sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//秒</span>
<span class="token keyword">int</span> Min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//分</span>
<span class="token keyword">int</span> Hour <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//时</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//LCD初始化</span>
	<span class="token function">Timer0Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//配置定时器</span>
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;  :  :&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">//显示时分秒</span>
		<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>Hour<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>Min<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span>Sec<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Timer0_Routine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span> <span class="token comment">//中断服务程序</span>
<span class="token punctuation">{</span>
	<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> T0Count<span class="token punctuation">;</span>
	TL0 <span class="token operator">=</span> <span class="token number">0x18</span><span class="token punctuation">;</span>	<span class="token comment">//设置定时初值</span>
	TH0 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span> <span class="token comment">//设置定时初值</span>
	T0Count<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count<span class="token operator">&gt;=</span><span class="token number">1000</span><span class="token punctuation">)</span> <span class="token comment">//定时器分频，1s</span>
	<span class="token punctuation">{</span>
		T0Count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		Sec<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//经过1秒，Sec+1</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Sec<span class="token operator">&gt;=</span><span class="token number">60</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token comment">//经过60秒Sec清0，Min+1</span>
			Sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			Min<span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Min<span class="token operator">&gt;=</span><span class="token number">60</span><span class="token punctuation">)</span>
			<span class="token punctuation">{</span>
				<span class="token comment">//经过60分钟Min清0，Hour+1</span>
				Min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
				Hour<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>Hour<span class="token operator">&gt;=</span><span class="token number">24</span><span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					Hour<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>	<span class="token comment">//经过24小时Hour清0</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="串口通信"><a href="#串口通信" class="header-anchor">#</a> 串口通信</h2> <h3 id="什么是串口通信"><a href="#什么是串口通信" class="header-anchor">#</a> 什么是串口通信?</h3> <p>串口通信（Serial Communication）是指通过串行接口（Serial Interface）进行数据传输的通信方式。在计算机和电子设备中，串口通信是一种常见的数据交换方式，用于在设备之间传输数据。</p> <h3 id="什么是串行通信-什么是并行通信"><a href="#什么是串行通信-什么是并行通信" class="header-anchor">#</a> 什么是串行通信？什么是并行通信？</h3> <p>串行通信（Serial Communication）是指在数据传输中，逐位地按照顺序传输数据的通信方式。在串行通信中，数据位按照顺序一个接一个地传输，每个数据位都紧跟着前一个数据位。串行通信使用单条通信线路进行数据传输，每次只传输一个数据位。</p> <p>串行通信相对于并行通信来说，使用的通信线路更少，可以减少连接线路的数量，减小系统的复杂度和成本。它常用于远距离通信和资源受限的系统中，如串口通信、以太网通信中的串行传输等。</p> <p>并行通信（Parallel Communication）是指在数据传输中，同时传输多个数据位的通信方式。在并行通信中，每个数据位都有自己的通信线路，数据位之间并行传输，同时进行。</p> <p>并行通信相对于串行通信来说，可以实现更高的数据传输速率，因为同时传输多个数据位。它常用于短距离通信和高速数据传输的场景，如计算机内部总线、内存与处理器之间的通信等。</p> <h3 id="异步通信和同步通信的区别是什么"><a href="#异步通信和同步通信的区别是什么" class="header-anchor">#</a> 异步通信和同步通信的区别是什么？</h3> <p>异步通信是一种基于字符为单位的通信方式，每个字符之间独立地传输，没有固定的时钟信号来同步发送端和接收端。每个字符都包含起始位、数据位、可选的校验位和停止位，起始位和停止位的特殊组合用于标识字符的开始和结束。接收端根据起始位和停止位来识别和解析每个字符，而不依赖于固定的时钟信号。异步通信常用于串口通信等场景。</p> <p>同步通信是一种基于数据块为单位的通信方式。在同步通信中，发送端和接收端通过共享的时钟信号来同步数据传输。数据被分成固定大小的块，每个块通过时钟信号的边沿进行同步传输。发送端和接收端的时钟频率必须相同或相近，以确保数据的正确传输。同步通信常用于高速数据传输和并行通信等场景。</p> <p>主要区别如下：</p> <ol><li><strong>时钟同步方式</strong>：异步通信没有固定的时钟信号，而同步通信使用共享的时钟信号来同步数据传输。</li> <li><strong>数据单位</strong>：异步通信以字符为单位进行传输，而同步通信以数据块为单位进行传输。</li> <li><strong>数据传输机制</strong>：异步通信通过起始位和停止位来标识字符的开始和结束，接收端根据这些位识别和解析数据。同步通信通过共享的时钟信号来同步发送端和接收端之间的数据传输。</li> <li><strong>应用场景</strong>：异步通信常用于串口通信等低速数据传输场景，而同步通信常用于高速数据传输和并行通信等场景。</li></ol> <h3 id="串行控制寄存器-scon"><a href="#串行控制寄存器-scon" class="header-anchor">#</a> 串行控制寄存器 SCON</h3> <p>用于控制串口通信的方式和状态，以及接收和发送</p> <table><thead><tr><th>位</th> <th>7</th> <th>6</th> <th>5</th> <th>4</th> <th>3</th> <th>2</th> <th>1</th> <th>0</th></tr></thead> <tbody><tr><td><strong>符号</strong></td> <td>SM0</td> <td>SM1</td> <td>SM2</td> <td>REN</td> <td>TB8</td> <td>RB8</td> <td>T1</td> <td>R1</td></tr> <tr><td><strong>复位值</strong></td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td></tr></tbody></table> <p><strong>串行控制寄存器 SCON 各标志位的用途</strong></p> <ul><li><strong>SM0</strong> 和 <strong>SM1</strong> 两个标志位用于控制串口通信的模式，两个标志位可以有 00，01，10，11 四种组合，对应着四种不同的通信模式</li></ul> <table><thead><tr><th>SM0</th> <th>SM1</th> <th>工作方式</th></tr></thead> <tbody><tr><td>0</td> <td>0</td> <td>同步移位寄存器方式</td></tr> <tr><td>0</td> <td>1</td> <td>8 位异步收发，波特率由定时器控制</td></tr> <tr><td>1</td> <td>0</td> <td>9 位异步收发，波特率为时钟频率的 1/64 或者 1/32</td></tr> <tr><td>1</td> <td>1</td> <td>9 位异步收发，波特率由定时器控制</td></tr></tbody></table> <ul><li><strong>SM2</strong> 多机位控制</li> <li><strong>REN</strong> 用于串口接收，当该标志位为 0 时禁止串口接收，为 1 时允许接收</li> <li><strong>TB8</strong> 用于<strong>发送</strong>第 9 位数据</li> <li><strong>RB8</strong> 用于<strong>接收</strong>第 9 位数据</li> <li><strong>TI</strong> 发送中断标志位，当数据<strong>发送</strong>完成后该标志位会自动置为 <code>1</code>，继续发送下一条数据是要把标志位置为 <code>0</code>）</li> <li><strong>RI</strong> 接收中断标志位，当数据<strong>接收</strong>完成后该标志位会自动置为 <code>1</code>，继续接收下一条数据是要把标志位置为 <code>0</code>）</li></ul> <div class="custom-block tip"><p class="custom-block-title">注意</p> <ul><li>通常情况下，只会用到<code>SM0</code>，<code>SM1</code>，<code>REN</code>，<code>TI</code>，<code>RI</code> 这 5 个标志位，其余的都不常用，将其置为 0 即可</li> <li>8 位异步收发时最常使用的串口通信模式，也就是<code>SM0=0</code>，<code>SM1=1</code></li></ul></div> <p>在电源控制寄存器 <strong>PCON</strong> 中只有最后一个标志位 <strong>SMOD</strong> 与串口通信有关，当<code>SMOD = 1</code>时，波特率提高一倍，复位后<code>SMOD = 0</code></p> <h3 id="什么是波特率"><a href="#什么是波特率" class="header-anchor">#</a> 什么是波特率？</h3> <p>波特率（Baud Rate）是指串口通信中单位时间内传输的符号或比特数。它表示了串口通信的数据传输速率，即每秒钟传输的比特数。</p> <p>波特率通常以单位时间内传输的符号数或比特数来表示，单位为波特（Baud）。例如，一个波特率为 9600 的串口表示每秒传输 9600 个符号或比特。</p> <p>波特率是串口通信中非常重要的参数，因为发送端和接收端需要以相同的波特率进行数据传输才能正确地解析和还原数据。如果发送端和接收端的波特率不一致，数据可能会被错误地解释，导致通信错误。</p> <p>选择适当的波特率取决于特定的应用需求和通信环境。较高的波特率可以实现更高的数据传输速率。常见的波特率值包括 9600、19200、38400、57600、115200 等，具体选择取决于设备和通信要求。</p> <h3 id="常用波特率初值表"><a href="#常用波特率初值表" class="header-anchor">#</a> 常用波特率初值表</h3> <table><thead><tr><th>波特率</th> <th>晶振频率</th> <th>SMOD=0</th> <th>SMOD=1</th></tr></thead> <tbody><tr><td>300</td> <td>11.0592</td> <td>0xA0</td> <td>0x40</td></tr> <tr><td>600</td> <td>11.0592</td> <td>0xD0</td> <td>0xA0</td></tr> <tr><td>1200</td> <td>11.0592</td> <td>0xE8</td> <td>0xD0</td></tr> <tr><td>1800</td> <td>11.0592</td> <td>0xF4</td> <td>0xE8</td></tr> <tr><td>3600</td> <td>11.0592</td> <td>0xF8</td> <td>0xF0</td></tr> <tr><td>4800</td> <td>11.0592</td> <td>0xFA</td> <td>0xF4</td></tr> <tr><td>7200</td> <td>11.0592</td> <td>0xFC</td> <td>0xF8</td></tr> <tr><td>9600</td> <td>11.0592</td> <td>0xFD</td> <td>0xFA</td></tr> <tr><td>14400</td> <td>11.0592</td> <td>0xFE</td> <td>0xFC</td></tr> <tr><td>19200</td> <td>11.0592</td> <td></td> <td>0xFD</td></tr> <tr><td>28800</td> <td>11.0592</td> <td>0xFF</td> <td>0xFE</td></tr></tbody></table> <h3 id="代码示例"><a href="#代码示例" class="header-anchor">#</a> 代码示例</h3> <p><strong>串口通信初始化</strong>：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> UART_Init（）
<span class="token punctuation">{</span>
SCON <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span> <span class="token comment">//01010000 //选择模式1</span>
PCON <span class="token operator">&amp;=</span> <span class="token number">0x7F</span><span class="token punctuation">;</span> <span class="token comment">//0111 1111 //波特率不翻倍</span>
TMOD <span class="token operator">&amp;=</span> <span class="token number">0x0F</span><span class="token punctuation">;</span> <span class="token comment">//00001111 //设置定时器模式</span>
TMOD <span class="token operator">|=</span> <span class="token number">0x20</span>；<span class="token comment">//00101111 //设置定时器模式</span>
TL1 <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token punctuation">;</span> <span class="token comment">//设定定时初值</span>
TH1 <span class="token operator">=</span> <span class="token number">0xFD</span><span class="token punctuation">;</span> <span class="token comment">//设定定时器重装值</span>
ET1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//禁止定时器1中断</span>
TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//启动定时器1</span>
EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//中断总开关</span>
ES <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//串口中断开关波特率品振</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>通过串口通信发送数据</strong>：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">UART_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Byte<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
SBUF <span class="token operator">=</span> Byte<span class="token punctuation">;</span> <span class="token comment">//将发送数据存到寄存器SBUF中</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>TI<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>SBUF</strong> 是串口缓冲寄存器，用于存储发送和接收的数据或者用于将数据传输到串口或从串口接收数据</li></ul> <p><strong>串口通信中断</strong>：</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">void</span> <span class="token function">UART_Routine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>RI<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果接收标志位为1时表示收到数据</span>
	<span class="token punctuation">{</span>
		RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//接收标志位清0</span>
		P2 <span class="token operator">=</span> SBUF <span class="token comment">//将接收到的数据存储在P2中</span>
		<span class="token function">UART_SendByte</span><span class="token punctuation">(</span>SBUF<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将接收到的数据发送出去</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="蓝牙模块通过串口通信控制舵机"><a href="#蓝牙模块通过串口通信控制舵机" class="header-anchor">#</a> 蓝牙模块通过串口通信控制舵机</h3> <p>蓝牙模块有6个引脚，其中 <code>STATE</code> 和 <code>EN</code> 不接 <code>VCC</code>接电源<code>5V</code>，<code>GND</code>接<code>GND</code>，<code>RXD</code>接<code>TXD</code>，<code>TXD</code>接<code>RXD</code></p> <p>舵机有三根线，其中两个分别为红色和黑色分别表示电源正极<code>VCC</code>和地线<code>GND</code>，另一根是信号线，接引脚<code>P1_2</code></p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SEH_PWM</span> <span class="token expression">P1_2</span><span class="token comment">//舵机PWM口定义</span></span>
 
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> SEH_count<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
 
 
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> T0RH <span class="token operator">=</span> <span class="token number">0xff</span><span class="token punctuation">;</span>  <span class="token comment">//T0重载值的高字节</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> T0RL <span class="token operator">=</span> <span class="token number">0xa3</span><span class="token punctuation">;</span>  <span class="token comment">//T0重载值的低字节</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> RxdByte <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//串口接收到的字节</span>
 
<span class="token keyword">void</span> <span class="token function">ConfigTimer0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">ConfigUART</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> baud<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">void</span> <span class="token function">PWM</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> x<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	SEH_count<span class="token operator">=</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    EA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">//使能总中断</span>
<span class="token punctuation">;</span>
    <span class="token function">ConfigTimer0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//配置T0定时1ms</span>
    <span class="token function">ConfigUART</span><span class="token punctuation">(</span><span class="token number">9600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//配置波特率为9600</span>
    
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>  
					<span class="token keyword">switch</span><span class="token punctuation">(</span>RxdByte<span class="token punctuation">)</span>
				<span class="token punctuation">{</span>
					<span class="token keyword">case</span> <span class="token number">0x31</span><span class="token operator">:</span><span class="token punctuation">{</span>
											<span class="token function">PWM</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手机向单片机发送‘0’，舵机转到0度    </span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x32</span><span class="token operator">:</span><span class="token punctuation">{</span>
										<span class="token function">PWM</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手机向单片机发送‘1’，舵机转到45度  </span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x33</span><span class="token operator">:</span><span class="token punctuation">{</span>
										<span class="token function">PWM</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手机向单片机发送‘2’，舵机转到90度  </span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x34</span><span class="token operator">:</span><span class="token punctuation">{</span>
										<span class="token function">PWM</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手机向单片机发送‘3’，舵机转到135度  </span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x35</span><span class="token operator">:</span><span class="token punctuation">{</span>
										<span class="token function">PWM</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//手机向单片机发送‘4’，舵机转到180度  </span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x36</span><span class="token operator">:</span><span class="token punctuation">{</span>
										<span class="token punctuation">;</span><span class="token comment">//														</span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x37</span><span class="token operator">:</span><span class="token punctuation">{</span>
									   <span class="token punctuation">;</span><span class="token comment">//																</span>
										<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token number">0x38</span><span class="token operator">:</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 配置并启动T0，ms-T0定时时间 */</span>
<span class="token keyword">void</span> <span class="token function">ConfigTimer0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  
 
 
    TMOD <span class="token operator">&amp;=</span> <span class="token number">0xF0</span><span class="token punctuation">;</span>   <span class="token comment">//清零T0的控制位</span>
    TMOD <span class="token operator">|=</span> <span class="token number">0x01</span><span class="token punctuation">;</span>   <span class="token comment">//配置T0为模式1</span>
    TH0 <span class="token operator">=</span> T0RH<span class="token punctuation">;</span>     <span class="token comment">//加载T0重载值</span>
    TL0 <span class="token operator">=</span> T0RL<span class="token punctuation">;</span>
    ET0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">//使能T0中断</span>
    TR0 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">//启动T0</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 串口配置函数，baud-通信波特率 */</span>
<span class="token keyword">void</span> <span class="token function">ConfigUART</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> baud<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    SCON  <span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">;</span>  <span class="token comment">//配置串口为模式1</span>
    TMOD <span class="token operator">&amp;=</span> <span class="token number">0x0F</span><span class="token punctuation">;</span>  <span class="token comment">//清零T1的控制位</span>
    TMOD <span class="token operator">|=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>  <span class="token comment">//配置T1为模式2</span>
    TH1 <span class="token operator">=</span> <span class="token number">256</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">11059200</span><span class="token operator">/</span><span class="token number">12</span><span class="token operator">/</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">/</span>baud<span class="token punctuation">;</span>  <span class="token comment">//计算T1重载值</span>
    TL1 <span class="token operator">=</span> TH1<span class="token punctuation">;</span>     <span class="token comment">//初值等于重载值</span>
    ET1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token comment">//禁止T1中断</span>
    ES  <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">//使能串口中断</span>
    TR1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment">//启动T1</span>
<span class="token punctuation">}</span>
 
<span class="token comment">/* 中断服务函数，完成LED扫描 */</span>
<span class="token keyword">void</span> <span class="token function">InterruptTimer0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">{</span>
    TH0 <span class="token operator">=</span> T0RH<span class="token punctuation">;</span>  <span class="token comment">//重新加载重载值</span>
    TL0 <span class="token operator">=</span> T0RL<span class="token punctuation">;</span>
	  <span class="token keyword">if</span><span class="token punctuation">(</span>count <span class="token operator">&lt;=</span> SEH_count<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
     
        SEH_PWM <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        SEH_PWM <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;=</span> <span class="token number">200</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
<span class="token punctuation">}</span>

<span class="token comment">/* UART中断服务函数 */</span>
<span class="token keyword">void</span> <span class="token function">InterruptUART</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">4</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>RI<span class="token punctuation">)</span>  <span class="token comment">//接收到字节</span>
    <span class="token punctuation">{</span>
        RI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//手动清零接收中断标志位</span>
        RxdByte <span class="token operator">=</span> SBUF<span class="token punctuation">;</span>  <span class="token comment">//接收到的数据保存到接收字节变量中</span>
        SBUF <span class="token operator">=</span> RxdByte<span class="token punctuation">;</span>  <span class="token comment">//接收到的数据又直接发回，叫作-&quot;echo&quot;，</span>
                         <span class="token comment">//用以提示用户输入的信息是否已正确接收</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>TI<span class="token punctuation">)</span>  <span class="token comment">//字节发送完毕</span>
    <span class="token punctuation">{</span>
        TI <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">//手动清零发送中断标志位</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><strong>参考</strong></p> <p><a href="https://blog.csdn.net/qq_41873236/article/details/116353829" target="_blank" rel="noopener noreferrer">单片机——SG90舵机工作原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.1cc258cf.js" defer></script><script src="/assets/js/3.107e051b.js" defer></script><script src="/assets/js/33.dae75e2c.js" defer></script><script src="/assets/js/5.56dd59ee.js" defer></script>
  </body>
</html>
